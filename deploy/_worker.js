var Fs=Object.defineProperty;var or=e=>{throw TypeError(e)};var zs=(e,r,s)=>r in e?Fs(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s;var p=(e,r,s)=>zs(e,typeof r!="symbol"?r+"":r,s),It=(e,r,s)=>r.has(e)||or("Cannot "+s);var u=(e,r,s)=>(It(e,r,"read from private field"),s?s.call(e):r.get(e)),w=(e,r,s)=>r.has(e)?or("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,s),g=(e,r,s,n)=>(It(e,r,"write to private field"),n?n.call(e,s):r.set(e,s),s),k=(e,r,s)=>(It(e,r,"access private method"),s);var dr=(e,r,s,n)=>({set _(i){g(e,r,i,s)},get _(){return u(e,r,n)}});var Gr={Stringify:1},M=(e,r)=>{const s=new String(e);return s.isEscaped=!0,s.callbacks=r,s},Gs=/[&<>'"]/,qr=async(e,r)=>{let s="";r||(r=[]);const n=await Promise.all(e);for(let i=n.length-1;s+=n[i],i--,!(i<0);i--){let a=n[i];typeof a=="object"&&r.push(...a.callbacks||[]);const l=a.isEscaped;if(a=await(typeof a=="object"?a.toString():a),typeof a=="object"&&r.push(...a.callbacks||[]),a.isEscaped??l)s+=a;else{const c=[s];ue(a,c),s=c[0]}}return M(s,r)},ue=(e,r)=>{const s=e.search(Gs);if(s===-1){r[0]+=e;return}let n,i,a=0;for(i=s;i<e.length;i++){switch(e.charCodeAt(i)){case 34:n="&quot;";break;case 39:n="&#39;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}r[0]+=e.substring(a,i)+n,a=i+1}r[0]+=e.substring(a,i)},Vr=e=>{const r=e.callbacks;if(!(r!=null&&r.length))return e;const s=[e],n={};return r.forEach(i=>i({phase:Gr.Stringify,buffer:s,context:n})),s[0]},Zr=async(e,r,s,n,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const a=e.callbacks;return a!=null&&a.length?(i?i[0]+=e:i=[e],Promise.all(a.map(c=>c({phase:r,buffer:i,context:n}))).then(c=>Promise.all(c.filter(Boolean).map(o=>Zr(o,r,!1,n,i))).then(()=>i[0]))):Promise.resolve(e)},qs=(e,...r)=>{const s=[""];for(let n=0,i=e.length-1;n<i;n++){s[0]+=e[n];const a=Array.isArray(r[n])?r[n].flat(1/0):[r[n]];for(let l=0,c=a.length;l<c;l++){const o=a[l];if(typeof o=="string")ue(o,s);else if(typeof o=="number")s[0]+=o;else{if(typeof o=="boolean"||o===null||o===void 0)continue;if(typeof o=="object"&&o.isEscaped)if(o.callbacks)s.unshift("",o);else{const d=o.toString();d instanceof Promise?s.unshift("",d):s[0]+=d}else o instanceof Promise?s.unshift("",o):ue(o.toString(),s)}}}return s[0]+=e.at(-1),s.length===1?"callbacks"in s?M(Vr(M(s[0],s.callbacks))):M(s[0]):qr(s,s.callbacks)},Yt=Symbol("RENDERER"),Ut=Symbol("ERROR_HANDLER"),R=Symbol("STASH"),Yr=Symbol("INTERNAL"),Vs=Symbol("MEMO"),At=Symbol("PERMALINK"),ur=e=>(e[Yr]=!0,e),Xr=e=>({value:r,children:s})=>{if(!s)return;const n={children:[{tag:ur(()=>{e.push(r)}),props:{}}]};Array.isArray(s)?n.children.push(...s.flat()):n.children.push(s),n.children.push({tag:ur(()=>{e.pop()}),props:{}});const i={tag:"",props:n,type:""};return i[Ut]=a=>{throw e.pop(),a},i},Qr=e=>{const r=[e],s=Xr(r);return s.values=r,s.Provider=s,_e.push(s),s},_e=[],Xt=e=>{const r=[e],s=n=>{r.push(n.value);let i;try{i=n.children?(Array.isArray(n.children)?new ss("",{},n.children):n.children).toString():""}finally{r.pop()}return i instanceof Promise?i.then(a=>M(a,a.callbacks)):M(i)};return s.values=r,s.Provider=s,s[Yt]=Xr(r),_e.push(s),s},Ke=e=>e.values.at(-1),bt={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},Wt={},gt="data-precedence",lt=e=>Array.isArray(e)?e:[e],hr=new WeakMap,fr=(e,r,s,n)=>({buffer:i,context:a})=>{if(!i)return;const l=hr.get(a)||{};hr.set(a,l);const c=l[e]||(l[e]=[]);let o=!1;const d=bt[e];if(d.length>0){e:for(const[,h]of c)for(const f of d)if(((h==null?void 0:h[f])??null)===(s==null?void 0:s[f])){o=!0;break e}}if(o?i[0]=i[0].replaceAll(r,""):d.length>0?c.push([r,s,n]):c.unshift([r,s,n]),i[0].indexOf("</head>")!==-1){let h;if(n===void 0)h=c.map(([f])=>f);else{const f=[];h=c.map(([m,,y])=>{let x=f.indexOf(y);return x===-1&&(f.push(y),x=f.length-1),[m,x]}).sort((m,y)=>m[1]-y[1]).map(([m])=>m)}h.forEach(f=>{i[0]=i[0].replaceAll(f,"")}),i[0]=i[0].replace(/(?=<\/head>)/,h.join(""))}},ct=(e,r,s)=>M(new H(e,s,lt(r??[])).toString()),ot=(e,r,s,n)=>{if("itemProp"in s)return ct(e,r,s);let{precedence:i,blocking:a,...l}=s;i=n?i??"":void 0,n&&(l[gt]=i);const c=new H(e,l,lt(r||[])).toString();return c instanceof Promise?c.then(o=>M(c,[...o.callbacks||[],fr(e,o,l,i)])):M(c,[fr(e,c,l,i)])},Zs=({children:e,...r})=>{const s=Qt();if(s){const n=Ke(s);if(n==="svg"||n==="head")return new H("title",r,lt(e??[]))}return ot("title",e,r,!1)},Ys=({children:e,...r})=>{const s=Qt();return["src","async"].some(n=>!r[n])||s&&Ke(s)==="head"?ct("script",e,r):ot("script",e,r,!1)},Xs=({children:e,...r})=>["href","precedence"].every(s=>s in r)?(r["data-href"]=r.href,delete r.href,ot("style",e,r,!0)):ct("style",e,r),Qs=({children:e,...r})=>["onLoad","onError"].some(s=>s in r)||r.rel==="stylesheet"&&(!("precedence"in r)||"disabled"in r)?ct("link",e,r):ot("link",e,r,"precedence"in r),en=({children:e,...r})=>{const s=Qt();return s&&Ke(s)==="head"?ct("meta",e,r):ot("meta",e,r,!1)},es=(e,{children:r,...s})=>new H(e,s,lt(r??[])),tn=e=>(typeof e.action=="function"&&(e.action=At in e.action?e.action[At]:void 0),es("form",e)),ts=(e,r)=>(typeof r.formAction=="function"&&(r.formAction=At in r.formAction?r.formAction[At]:void 0),es(e,r)),rn=e=>ts("input",e),sn=e=>ts("button",e);const Tt=Object.freeze(Object.defineProperty({__proto__:null,button:sn,form:tn,input:rn,link:Qs,meta:en,script:Ys,style:Xs,title:Zs},Symbol.toStringTag,{value:"Module"}));var nn=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),kt=e=>nn.get(e)||e,rs=(e,r)=>{for(const[s,n]of Object.entries(e)){const i=s[0]==="-"||!/[A-Z]/.test(s)?s:s.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`);r(i,n==null?null:typeof n=="number"?i.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${n}`:`${n}px`:n)}},ze=void 0,Qt=()=>ze,an=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,ln=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],cn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],er=(e,r)=>{for(let s=0,n=e.length;s<n;s++){const i=e[s];if(typeof i=="string")ue(i,r);else{if(typeof i=="boolean"||i===null||i===void 0)continue;i instanceof H?i.toStringToBuffer(r):typeof i=="number"||i.isEscaped?r[0]+=i:i instanceof Promise?r.unshift("",i):er(i,r)}}},H=class{constructor(e,r,s){p(this,"tag");p(this,"props");p(this,"key");p(this,"children");p(this,"isEscaped",!0);p(this,"localContexts");this.tag=e,this.props=r,this.children=s}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var r,s;const e=[""];(r=this.localContexts)==null||r.forEach(([n,i])=>{n.values.push(i)});try{this.toStringToBuffer(e)}finally{(s=this.localContexts)==null||s.forEach(([n])=>{n.values.pop()})}return e.length===1?"callbacks"in e?Vr(M(e[0],e.callbacks)).toString():e[0]:qr(e,e.callbacks)}toStringToBuffer(e){const r=this.tag,s=this.props;let{children:n}=this;e[0]+=`<${r}`;const i=ze&&Ke(ze)==="svg"?a=>an(kt(a)):a=>kt(a);for(let[a,l]of Object.entries(s))if(a=i(a),a!=="children"){if(a==="style"&&typeof l=="object"){let c="";rs(l,(o,d)=>{d!=null&&(c+=`${c?";":""}${o}:${d}`)}),e[0]+=' style="',ue(c,e),e[0]+='"'}else if(typeof l=="string")e[0]+=` ${a}="`,ue(l,e),e[0]+='"';else if(l!=null)if(typeof l=="number"||l.isEscaped)e[0]+=` ${a}="${l}"`;else if(typeof l=="boolean"&&cn.includes(a))l&&(e[0]+=` ${a}=""`);else if(a==="dangerouslySetInnerHTML"){if(n.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n=[M(l.__html)]}else if(l instanceof Promise)e[0]+=` ${a}="`,e.unshift('"',l);else if(typeof l=="function"){if(!a.startsWith("on")&&a!=="ref")throw new Error(`Invalid prop '${a}' of type 'function' supplied to '${r}'.`)}else e[0]+=` ${a}="`,ue(l.toString(),e),e[0]+='"'}if(ln.includes(r)&&n.length===0){e[0]+="/>";return}e[0]+=">",er(n,e),e[0]+=`</${r}>`}},jt=class extends H{toStringToBuffer(e){const{children:r}=this,s=this.tag.call(null,{...this.props,children:r.length<=1?r[0]:r});if(!(typeof s=="boolean"||s==null))if(s instanceof Promise)if(_e.length===0)e.unshift("",s);else{const n=_e.map(i=>[i,i.values.at(-1)]);e.unshift("",s.then(i=>(i instanceof H&&(i.localContexts=n),i)))}else s instanceof H?s.toStringToBuffer(e):typeof s=="number"||s.isEscaped?(e[0]+=s,s.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...s.callbacks))):ue(s,e)}},ss=class extends H{toStringToBuffer(e){er(this.children,e)}},mr=(e,r,...s)=>{r??(r={}),s.length&&(r.children=s.length===1?s[0]:s);const n=r.key;delete r.key;const i=yt(e,r,s);return i.key=n,i},pr=!1,yt=(e,r,s)=>{if(!pr){for(const n in Wt)Tt[n][Yt]=Wt[n];pr=!0}return typeof e=="function"?new jt(e,r,s):Tt[e]?new jt(Tt[e],r,s):e==="svg"||e==="head"?(ze||(ze=Xt("")),new H(e,r,[new jt(ze,{value:e},s)])):new H(e,r,s)},on=({children:e})=>new ss("",{children:e},Array.isArray(e)?e:e?[e]:[]);function t(e,r,s){let n;if(!r||!("children"in r))n=yt(e,r,[]);else{const i=r.children;n=Array.isArray(i)?yt(e,r,i):yt(e,r,[i])}return n.key=s,n}var br=(e,r,s)=>(n,i)=>{let a=-1;return l(0);async function l(c){if(c<=a)throw new Error("next() called multiple times");a=c;let o,d=!1,h;if(e[c]?(h=e[c][0][0],n.req.routeIndex=c):h=c===e.length&&i||void 0,h)try{o=await h(n,()=>l(c+1))}catch(f){if(f instanceof Error&&r)n.error=f,o=await r(f,n),d=!0;else throw f}else n.finalized===!1&&s&&(o=await s(n));return o&&(n.finalized===!1||d)&&(n.res=o),n}},dn=Symbol(),un=async(e,r=Object.create(null))=>{const{all:s=!1,dot:n=!1}=r,a=(e instanceof os?e.raw.headers:e.headers).get("Content-Type");return a!=null&&a.startsWith("multipart/form-data")||a!=null&&a.startsWith("application/x-www-form-urlencoded")?hn(e,{all:s,dot:n}):{}};async function hn(e,r){const s=await e.formData();return s?fn(s,r):{}}function fn(e,r){const s=Object.create(null);return e.forEach((n,i)=>{r.all||i.endsWith("[]")?mn(s,i,n):s[i]=n}),r.dot&&Object.entries(s).forEach(([n,i])=>{n.includes(".")&&(pn(s,n,i),delete s[n])}),s}var mn=(e,r,s)=>{e[r]!==void 0?Array.isArray(e[r])?e[r].push(s):e[r]=[e[r],s]:r.endsWith("[]")?e[r]=[s]:e[r]=s},pn=(e,r,s)=>{let n=e;const i=r.split(".");i.forEach((a,l)=>{l===i.length-1?n[a]=s:((!n[a]||typeof n[a]!="object"||Array.isArray(n[a])||n[a]instanceof File)&&(n[a]=Object.create(null)),n=n[a])})},ns=e=>{const r=e.split("/");return r[0]===""&&r.shift(),r},bn=e=>{const{groups:r,path:s}=gn(e),n=ns(s);return yn(n,r)},gn=e=>{const r=[];return e=e.replace(/\{[^}]+\}/g,(s,n)=>{const i=`@${n}`;return r.push([i,s]),i}),{groups:r,path:e}},yn=(e,r)=>{for(let s=r.length-1;s>=0;s--){const[n]=r[s];for(let i=e.length-1;i>=0;i--)if(e[i].includes(n)){e[i]=e[i].replace(n,r[s][1]);break}}return e},ht={},xn=(e,r)=>{if(e==="*")return"*";const s=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(s){const n=`${e}#${r}`;return ht[n]||(s[2]?ht[n]=r&&r[0]!==":"&&r[0]!=="*"?[n,s[1],new RegExp(`^${s[2]}(?=/${r})`)]:[e,s[1],new RegExp(`^${s[2]}$`)]:ht[n]=[e,s[1],!0]),ht[n]}return null},tr=(e,r)=>{try{return r(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,s=>{try{return r(s)}catch{return s}})}},vn=e=>tr(e,decodeURI),is=e=>{const r=e.url,s=r.indexOf("/",r.charCodeAt(9)===58?13:8);let n=s;for(;n<r.length;n++){const i=r.charCodeAt(n);if(i===37){const a=r.indexOf("?",n),l=r.slice(s,a===-1?void 0:a);return vn(l.includes("%25")?l.replace(/%25/g,"%2525"):l)}else if(i===63)break}return r.slice(s,n)},wn=e=>{const r=is(e);return r.length>1&&r.at(-1)==="/"?r.slice(0,-1):r},Ae=(e,r,...s)=>(s.length&&(r=Ae(r,...s)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${r==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(r==null?void 0:r[0])==="/"?r.slice(1):r}`}`),as=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const r=e.split("/"),s=[];let n="";return r.forEach(i=>{if(i!==""&&!/\:/.test(i))n+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){s.length===0&&n===""?s.push("/"):s.push(n);const a=i.replace("?","");n+="/"+a,s.push(n)}else n+="/"+i}),s.filter((i,a,l)=>l.indexOf(i)===a)},Bt=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?tr(e,cs):e):e,ls=(e,r,s)=>{let n;if(!s&&r&&!/[%+]/.test(r)){let l=e.indexOf(`?${r}`,8);for(l===-1&&(l=e.indexOf(`&${r}`,8));l!==-1;){const c=e.charCodeAt(l+r.length+1);if(c===61){const o=l+r.length+2,d=e.indexOf("&",o);return Bt(e.slice(o,d===-1?void 0:d))}else if(c==38||isNaN(c))return"";l=e.indexOf(`&${r}`,l+1)}if(n=/[%+]/.test(e),!n)return}const i={};n??(n=/[%+]/.test(e));let a=e.indexOf("?",8);for(;a!==-1;){const l=e.indexOf("&",a+1);let c=e.indexOf("=",a);c>l&&l!==-1&&(c=-1);let o=e.slice(a+1,c===-1?l===-1?void 0:l:c);if(n&&(o=Bt(o)),a=l,o==="")continue;let d;c===-1?d="":(d=e.slice(c+1,l===-1?void 0:l),n&&(d=Bt(d))),s?(i[o]&&Array.isArray(i[o])||(i[o]=[]),i[o].push(d)):i[o]??(i[o]=d)}return r?i[r]:i},En=ls,Sn=(e,r)=>ls(e,r,!0),cs=decodeURIComponent,gr=e=>tr(e,cs),Ie,N,se,ds,us,Ht,ie,Dr,os=(Dr=class{constructor(e,r="/",s=[[]]){w(this,se);p(this,"raw");w(this,Ie);w(this,N);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});w(this,ie,e=>{const{bodyCache:r,raw:s}=this,n=r[e];if(n)return n;const i=Object.keys(r)[0];return i?r[i].then(a=>(i==="json"&&(a=JSON.stringify(a)),new Response(a)[e]())):r[e]=s[e]()});this.raw=e,this.path=r,g(this,N,s),g(this,Ie,{})}param(e){return e?k(this,se,ds).call(this,e):k(this,se,us).call(this)}query(e){return En(this.url,e)}queries(e){return Sn(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const r={};return this.raw.headers.forEach((s,n)=>{r[n]=s}),r}async parseBody(e){var r;return(r=this.bodyCache).parsedBody??(r.parsedBody=await un(this,e))}json(){return u(this,ie).call(this,"text").then(e=>JSON.parse(e))}text(){return u(this,ie).call(this,"text")}arrayBuffer(){return u(this,ie).call(this,"arrayBuffer")}blob(){return u(this,ie).call(this,"blob")}formData(){return u(this,ie).call(this,"formData")}addValidatedData(e,r){u(this,Ie)[e]=r}valid(e){return u(this,Ie)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[dn](){return u(this,N)}get matchedRoutes(){return u(this,N)[0].map(([[,e]])=>e)}get routePath(){return u(this,N)[0].map(([[,e]])=>e)[this.routeIndex].path}},Ie=new WeakMap,N=new WeakMap,se=new WeakSet,ds=function(e){const r=u(this,N)[0][this.routeIndex][1][e],s=k(this,se,Ht).call(this,r);return s?/\%/.test(s)?gr(s):s:void 0},us=function(){const e={},r=Object.keys(u(this,N)[0][this.routeIndex][1]);for(const s of r){const n=k(this,se,Ht).call(this,u(this,N)[0][this.routeIndex][1][s]);n&&typeof n=="string"&&(e[s]=/\%/.test(n)?gr(n):n)}return e},Ht=function(e){return u(this,N)[1]?u(this,N)[1][e]:e},ie=new WeakMap,Dr),An="text/plain; charset=UTF-8",Ot=(e,r)=>({"Content-Type":e,...r}),Ze,Ye,Z,Te,Y,D,Xe,je,Be,be,Qe,et,ae,ke,_r,kn=(_r=class{constructor(e,r){w(this,ae);w(this,Ze);w(this,Ye);p(this,"env",{});w(this,Z);p(this,"finalized",!1);p(this,"error");w(this,Te);w(this,Y);w(this,D);w(this,Xe);w(this,je);w(this,Be);w(this,be);w(this,Qe);w(this,et);p(this,"render",(...e)=>(u(this,je)??g(this,je,r=>this.html(r)),u(this,je).call(this,...e)));p(this,"setLayout",e=>g(this,Xe,e));p(this,"getLayout",()=>u(this,Xe));p(this,"setRenderer",e=>{g(this,je,e)});p(this,"header",(e,r,s)=>{this.finalized&&g(this,D,new Response(u(this,D).body,u(this,D)));const n=u(this,D)?u(this,D).headers:u(this,be)??g(this,be,new Headers);r===void 0?n.delete(e):s!=null&&s.append?n.append(e,r):n.set(e,r)});p(this,"status",e=>{g(this,Te,e)});p(this,"set",(e,r)=>{u(this,Z)??g(this,Z,new Map),u(this,Z).set(e,r)});p(this,"get",e=>u(this,Z)?u(this,Z).get(e):void 0);p(this,"newResponse",(...e)=>k(this,ae,ke).call(this,...e));p(this,"body",(e,r,s)=>k(this,ae,ke).call(this,e,r,s));p(this,"text",(e,r,s)=>!u(this,be)&&!u(this,Te)&&!r&&!s&&!this.finalized?new Response(e):k(this,ae,ke).call(this,e,r,Ot(An,s)));p(this,"json",(e,r,s)=>k(this,ae,ke).call(this,JSON.stringify(e),r,Ot("application/json",s)));p(this,"html",(e,r,s)=>{const n=i=>k(this,ae,ke).call(this,i,r,Ot("text/html; charset=UTF-8",s));return typeof e=="object"?Zr(e,Gr.Stringify,!1,{}).then(n):n(e)});p(this,"redirect",(e,r)=>{const s=String(e);return this.header("Location",/[^\x00-\xFF]/.test(s)?encodeURI(s):s),this.newResponse(null,r??302)});p(this,"notFound",()=>(u(this,Be)??g(this,Be,()=>new Response),u(this,Be).call(this,this)));g(this,Ze,e),r&&(g(this,Y,r.executionCtx),this.env=r.env,g(this,Be,r.notFoundHandler),g(this,et,r.path),g(this,Qe,r.matchResult))}get req(){return u(this,Ye)??g(this,Ye,new os(u(this,Ze),u(this,et),u(this,Qe))),u(this,Ye)}get event(){if(u(this,Y)&&"respondWith"in u(this,Y))return u(this,Y);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,Y))return u(this,Y);throw Error("This context has no ExecutionContext")}get res(){return u(this,D)||g(this,D,new Response(null,{headers:u(this,be)??g(this,be,new Headers)}))}set res(e){if(u(this,D)&&e){e=new Response(e.body,e);for(const[r,s]of u(this,D).headers.entries())if(r!=="content-type")if(r==="set-cookie"){const n=u(this,D).headers.getSetCookie();e.headers.delete("set-cookie");for(const i of n)e.headers.append("set-cookie",i)}else e.headers.set(r,s)}g(this,D,e),this.finalized=!0}get var(){return u(this,Z)?Object.fromEntries(u(this,Z)):{}}},Ze=new WeakMap,Ye=new WeakMap,Z=new WeakMap,Te=new WeakMap,Y=new WeakMap,D=new WeakMap,Xe=new WeakMap,je=new WeakMap,Be=new WeakMap,be=new WeakMap,Qe=new WeakMap,et=new WeakMap,ae=new WeakSet,ke=function(e,r,s){const n=u(this,D)?new Headers(u(this,D).headers):u(this,be)??new Headers;if(typeof r=="object"&&"headers"in r){const a=r.headers instanceof Headers?r.headers:new Headers(r.headers);for(const[l,c]of a)l.toLowerCase()==="set-cookie"?n.append(l,c):n.set(l,c)}if(s)for(const[a,l]of Object.entries(s))if(typeof l=="string")n.set(a,l);else{n.delete(a);for(const c of l)n.append(a,c)}const i=typeof r=="number"?r:(r==null?void 0:r.status)??u(this,Te);return new Response(e,{status:i,headers:n})},_r),I="ALL",Cn="all",Pn=["get","post","put","delete","options","patch"],hs="Can not add a route since the matcher is already built.",fs=class extends Error{},Rn="__COMPOSED_HANDLER",In=e=>e.text("404 Not Found",404),yr=(e,r)=>{if("getResponse"in e){const s=e.getResponse();return r.newResponse(s.body,s)}return console.error(e),r.text("Internal Server Error",500)},$,T,ps,U,me,xt,vt,Nr,ms=(Nr=class{constructor(r={}){w(this,T);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");w(this,$,"/");p(this,"routes",[]);w(this,U,In);p(this,"errorHandler",yr);p(this,"onError",r=>(this.errorHandler=r,this));p(this,"notFound",r=>(g(this,U,r),this));p(this,"fetch",(r,...s)=>k(this,T,vt).call(this,r,s[1],s[0],r.method));p(this,"request",(r,s,n,i)=>r instanceof Request?this.fetch(s?new Request(r,s):r,n,i):(r=r.toString(),this.fetch(new Request(/^https?:\/\//.test(r)?r:`http://localhost${Ae("/",r)}`,s),n,i)));p(this,"fire",()=>{addEventListener("fetch",r=>{r.respondWith(k(this,T,vt).call(this,r.request,r,void 0,r.request.method))})});[...Pn,Cn].forEach(a=>{this[a]=(l,...c)=>(typeof l=="string"?g(this,$,l):k(this,T,me).call(this,a,u(this,$),l),c.forEach(o=>{k(this,T,me).call(this,a,u(this,$),o)}),this)}),this.on=(a,l,...c)=>{for(const o of[l].flat()){g(this,$,o);for(const d of[a].flat())c.map(h=>{k(this,T,me).call(this,d.toUpperCase(),u(this,$),h)})}return this},this.use=(a,...l)=>(typeof a=="string"?g(this,$,a):(g(this,$,"*"),l.unshift(a)),l.forEach(c=>{k(this,T,me).call(this,I,u(this,$),c)}),this);const{strict:n,...i}=r;Object.assign(this,i),this.getPath=n??!0?r.getPath??is:wn}route(r,s){const n=this.basePath(r);return s.routes.map(i=>{var l;let a;s.errorHandler===yr?a=i.handler:(a=async(c,o)=>(await br([],s.errorHandler)(c,()=>i.handler(c,o))).res,a[Rn]=i.handler),k(l=n,T,me).call(l,i.method,i.path,a)}),this}basePath(r){const s=k(this,T,ps).call(this);return s._basePath=Ae(this._basePath,r),s}mount(r,s,n){let i,a;n&&(typeof n=="function"?a=n:(a=n.optionHandler,n.replaceRequest===!1?i=o=>o:i=n.replaceRequest));const l=a?o=>{const d=a(o);return Array.isArray(d)?d:[d]}:o=>{let d;try{d=o.executionCtx}catch{}return[o.env,d]};i||(i=(()=>{const o=Ae(this._basePath,r),d=o==="/"?0:o.length;return h=>{const f=new URL(h.url);return f.pathname=f.pathname.slice(d)||"/",new Request(f,h)}})());const c=async(o,d)=>{const h=await s(i(o.req.raw),...l(o));if(h)return h;await d()};return k(this,T,me).call(this,I,Ae(r,"*"),c),this}},$=new WeakMap,T=new WeakSet,ps=function(){const r=new ms({router:this.router,getPath:this.getPath});return r.errorHandler=this.errorHandler,g(r,U,u(this,U)),r.routes=this.routes,r},U=new WeakMap,me=function(r,s,n){r=r.toUpperCase(),s=Ae(this._basePath,s);const i={basePath:this._basePath,path:s,method:r,handler:n};this.router.add(r,s,[n,i]),this.routes.push(i)},xt=function(r,s){if(r instanceof Error)return this.errorHandler(r,s);throw r},vt=function(r,s,n,i){if(i==="HEAD")return(async()=>new Response(null,await k(this,T,vt).call(this,r,s,n,"GET")))();const a=this.getPath(r,{env:n}),l=this.router.match(i,a),c=new kn(r,{path:a,matchResult:l,env:n,executionCtx:s,notFoundHandler:u(this,U)});if(l[0].length===1){let d;try{d=l[0][0][0][0](c,async()=>{c.res=await u(this,U).call(this,c)})}catch(h){return k(this,T,xt).call(this,h,c)}return d instanceof Promise?d.then(h=>h||(c.finalized?c.res:u(this,U).call(this,c))).catch(h=>k(this,T,xt).call(this,h,c)):d??u(this,U).call(this,c)}const o=br(l[0],this.errorHandler,u(this,U));return(async()=>{try{const d=await o(c);if(!d.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return d.res}catch(d){return k(this,T,xt).call(this,d,c)}})()},Nr),Ct="[^/]+",He=".*",Je="(?:|/.*)",Ce=Symbol(),Tn=new Set(".\\+*[^]$()");function jn(e,r){return e.length===1?r.length===1?e<r?-1:1:-1:r.length===1||e===He||e===Je?1:r===He||r===Je?-1:e===Ct?1:r===Ct?-1:e.length===r.length?e<r?-1:1:r.length-e.length}var ge,ye,W,Mr,Jt=(Mr=class{constructor(){w(this,ge);w(this,ye);w(this,W,Object.create(null))}insert(r,s,n,i,a){if(r.length===0){if(u(this,ge)!==void 0)throw Ce;if(a)return;g(this,ge,s);return}const[l,...c]=r,o=l==="*"?c.length===0?["","",He]:["","",Ct]:l==="/*"?["","",Je]:l.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let d;if(o){const h=o[1];let f=o[2]||Ct;if(h&&o[2]&&(f===".*"||(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))))throw Ce;if(d=u(this,W)[f],!d){if(Object.keys(u(this,W)).some(m=>m!==He&&m!==Je))throw Ce;if(a)return;d=u(this,W)[f]=new Jt,h!==""&&g(d,ye,i.varIndex++)}!a&&h!==""&&n.push([h,u(d,ye)])}else if(d=u(this,W)[l],!d){if(Object.keys(u(this,W)).some(h=>h.length>1&&h!==He&&h!==Je))throw Ce;if(a)return;d=u(this,W)[l]=new Jt}d.insert(c,s,n,i,a)}buildRegExpStr(){const s=Object.keys(u(this,W)).sort(jn).map(n=>{const i=u(this,W)[n];return(typeof u(i,ye)=="number"?`(${n})@${u(i,ye)}`:Tn.has(n)?`\\${n}`:n)+i.buildRegExpStr()});return typeof u(this,ge)=="number"&&s.unshift(`#${u(this,ge)}`),s.length===0?"":s.length===1?s[0]:"(?:"+s.join("|")+")"}},ge=new WeakMap,ye=new WeakMap,W=new WeakMap,Mr),Pt,tt,Kr,Bn=(Kr=class{constructor(){w(this,Pt,{varIndex:0});w(this,tt,new Jt)}insert(e,r,s){const n=[],i=[];for(let l=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const d=`@\\${l}`;return i[l]=[d,o],l++,c=!0,d}),!c)break}const a=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let l=i.length-1;l>=0;l--){const[c]=i[l];for(let o=a.length-1;o>=0;o--)if(a[o].indexOf(c)!==-1){a[o]=a[o].replace(c,i[l][1]);break}}return u(this,tt).insert(a,r,n,u(this,Pt),s),n}buildRegExp(){let e=u(this,tt).buildRegExpStr();if(e==="")return[/^$/,[],[]];let r=0;const s=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,a,l)=>a!==void 0?(s[++r]=Number(a),"$()"):(l!==void 0&&(n[Number(l)]=++r),"")),[new RegExp(`^${e}`),s,n]}},Pt=new WeakMap,tt=new WeakMap,Kr),bs=[],On=[/^$/,[],Object.create(null)],wt=Object.create(null);function gs(e){return wt[e]??(wt[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(r,s)=>s?`\\${s}`:"(?:|/.*)")}$`))}function Ln(){wt=Object.create(null)}function Dn(e){var d;const r=new Bn,s=[];if(e.length===0)return On;const n=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,f],[m,y])=>h?1:m?-1:f.length-y.length),i=Object.create(null);for(let h=0,f=-1,m=n.length;h<m;h++){const[y,x,b]=n[h];y?i[x]=[b.map(([E])=>[E,Object.create(null)]),bs]:f++;let v;try{v=r.insert(x,f,y)}catch(E){throw E===Ce?new fs(x):E}y||(s[f]=b.map(([E,S])=>{const C=Object.create(null);for(S-=1;S>=0;S--){const[A,O]=v[S];C[A]=O}return[E,C]}))}const[a,l,c]=r.buildRegExp();for(let h=0,f=s.length;h<f;h++)for(let m=0,y=s[h].length;m<y;m++){const x=(d=s[h][m])==null?void 0:d[1];if(!x)continue;const b=Object.keys(x);for(let v=0,E=b.length;v<E;v++)x[b[v]]=c[x[b[v]]]}const o=[];for(const h in l)o[h]=s[l[h]];return[a,o,i]}function Ee(e,r){if(e){for(const s of Object.keys(e).sort((n,i)=>i.length-n.length))if(gs(s).test(r))return[...e[s]]}}var le,ce,Me,ys,xs,$r,_n=($r=class{constructor(){w(this,Me);p(this,"name","RegExpRouter");w(this,le);w(this,ce);g(this,le,{[I]:Object.create(null)}),g(this,ce,{[I]:Object.create(null)})}add(e,r,s){var c;const n=u(this,le),i=u(this,ce);if(!n||!i)throw new Error(hs);n[e]||[n,i].forEach(o=>{o[e]=Object.create(null),Object.keys(o[I]).forEach(d=>{o[e][d]=[...o[I][d]]})}),r==="/*"&&(r="*");const a=(r.match(/\/:/g)||[]).length;if(/\*$/.test(r)){const o=gs(r);e===I?Object.keys(n).forEach(d=>{var h;(h=n[d])[r]||(h[r]=Ee(n[d],r)||Ee(n[I],r)||[])}):(c=n[e])[r]||(c[r]=Ee(n[e],r)||Ee(n[I],r)||[]),Object.keys(n).forEach(d=>{(e===I||e===d)&&Object.keys(n[d]).forEach(h=>{o.test(h)&&n[d][h].push([s,a])})}),Object.keys(i).forEach(d=>{(e===I||e===d)&&Object.keys(i[d]).forEach(h=>o.test(h)&&i[d][h].push([s,a]))});return}const l=as(r)||[r];for(let o=0,d=l.length;o<d;o++){const h=l[o];Object.keys(i).forEach(f=>{var m;(e===I||e===f)&&((m=i[f])[h]||(m[h]=[...Ee(n[f],h)||Ee(n[I],h)||[]]),i[f][h].push([s,a-d+o+1]))})}}match(e,r){Ln();const s=k(this,Me,ys).call(this);return this.match=(n,i)=>{const a=s[n]||s[I],l=a[2][i];if(l)return l;const c=i.match(a[0]);if(!c)return[[],bs];const o=c.indexOf("",1);return[a[1][o],c]},this.match(e,r)}},le=new WeakMap,ce=new WeakMap,Me=new WeakSet,ys=function(){const e=Object.create(null);return Object.keys(u(this,ce)).concat(Object.keys(u(this,le))).forEach(r=>{e[r]||(e[r]=k(this,Me,xs).call(this,r))}),g(this,le,g(this,ce,void 0)),e},xs=function(e){const r=[];let s=e===I;return[u(this,le),u(this,ce)].forEach(n=>{const i=n[e]?Object.keys(n[e]).map(a=>[a,n[e][a]]):[];i.length!==0?(s||(s=!0),r.push(...i)):e!==I&&r.push(...Object.keys(n[I]).map(a=>[a,n[I][a]]))}),s?Dn(r):null},$r),oe,X,Ur,Nn=(Ur=class{constructor(e){p(this,"name","SmartRouter");w(this,oe,[]);w(this,X,[]);g(this,oe,e.routers)}add(e,r,s){if(!u(this,X))throw new Error(hs);u(this,X).push([e,r,s])}match(e,r){if(!u(this,X))throw new Error("Fatal error");const s=u(this,oe),n=u(this,X),i=s.length;let a=0,l;for(;a<i;a++){const c=s[a];try{for(let o=0,d=n.length;o<d;o++)c.add(...n[o]);l=c.match(e,r)}catch(o){if(o instanceof fs)continue;throw o}this.match=c.match.bind(c),g(this,oe,[c]),g(this,X,void 0);break}if(a===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,l}get activeRouter(){if(u(this,X)||u(this,oe).length!==1)throw new Error("No active router has been determined yet.");return u(this,oe)[0]}},oe=new WeakMap,X=new WeakMap,Ur),$e=Object.create(null),de,L,xe,Oe,B,Q,pe,Wr,vs=(Wr=class{constructor(e,r,s){w(this,Q);w(this,de);w(this,L);w(this,xe);w(this,Oe,0);w(this,B,$e);if(g(this,L,s||Object.create(null)),g(this,de,[]),e&&r){const n=Object.create(null);n[e]={handler:r,possibleKeys:[],score:0},g(this,de,[n])}g(this,xe,[])}insert(e,r,s){g(this,Oe,++dr(this,Oe)._);let n=this;const i=bn(r),a=[];for(let l=0,c=i.length;l<c;l++){const o=i[l],d=i[l+1],h=xn(o,d),f=Array.isArray(h)?h[0]:o;if(f in u(n,L)){n=u(n,L)[f],h&&a.push(h[1]);continue}u(n,L)[f]=new vs,h&&(u(n,xe).push(h),a.push(h[1])),n=u(n,L)[f]}return u(n,de).push({[e]:{handler:s,possibleKeys:a.filter((l,c,o)=>o.indexOf(l)===c),score:u(this,Oe)}}),n}search(e,r){var c;const s=[];g(this,B,$e);let i=[this];const a=ns(r),l=[];for(let o=0,d=a.length;o<d;o++){const h=a[o],f=o===d-1,m=[];for(let y=0,x=i.length;y<x;y++){const b=i[y],v=u(b,L)[h];v&&(g(v,B,u(b,B)),f?(u(v,L)["*"]&&s.push(...k(this,Q,pe).call(this,u(v,L)["*"],e,u(b,B))),s.push(...k(this,Q,pe).call(this,v,e,u(b,B)))):m.push(v));for(let E=0,S=u(b,xe).length;E<S;E++){const C=u(b,xe)[E],A=u(b,B)===$e?{}:{...u(b,B)};if(C==="*"){const ne=u(b,L)["*"];ne&&(s.push(...k(this,Q,pe).call(this,ne,e,u(b,B))),g(ne,B,A),m.push(ne));continue}const[O,we,fe]=C;if(!h&&!(fe instanceof RegExp))continue;const G=u(b,L)[O],Js=a.slice(o).join("/");if(fe instanceof RegExp){const ne=fe.exec(Js);if(ne){if(A[we]=ne[0],s.push(...k(this,Q,pe).call(this,G,e,u(b,B),A)),Object.keys(u(G,L)).length){g(G,B,A);const Rt=((c=ne[0].match(/\//))==null?void 0:c.length)??0;(l[Rt]||(l[Rt]=[])).push(G)}continue}}(fe===!0||fe.test(h))&&(A[we]=h,f?(s.push(...k(this,Q,pe).call(this,G,e,A,u(b,B))),u(G,L)["*"]&&s.push(...k(this,Q,pe).call(this,u(G,L)["*"],e,A,u(b,B)))):(g(G,B,A),m.push(G)))}}i=m.concat(l.shift()??[])}return s.length>1&&s.sort((o,d)=>o.score-d.score),[s.map(({handler:o,params:d})=>[o,d])]}},de=new WeakMap,L=new WeakMap,xe=new WeakMap,Oe=new WeakMap,B=new WeakMap,Q=new WeakSet,pe=function(e,r,s,n){const i=[];for(let a=0,l=u(e,de).length;a<l;a++){const c=u(e,de)[a],o=c[r]||c[I],d={};if(o!==void 0&&(o.params=Object.create(null),i.push(o),s!==$e||n&&n!==$e))for(let h=0,f=o.possibleKeys.length;h<f;h++){const m=o.possibleKeys[h],y=d[o.score];o.params[m]=n!=null&&n[m]&&!y?n[m]:s[m]??(n==null?void 0:n[m]),d[o.score]=!0}}return i},Wr),ve,Hr,Mn=(Hr=class{constructor(){p(this,"name","TrieRouter");w(this,ve);g(this,ve,new vs)}add(e,r,s){const n=as(r);if(n){for(let i=0,a=n.length;i<a;i++)u(this,ve).insert(e,n[i],s);return}u(this,ve).insert(e,r,s)}match(e,r){return u(this,ve).search(e,r)}},ve=new WeakMap,Hr),ws=class extends ms{constructor(e={}){super(e),this.router=e.router??new Nn({routers:[new _n,new Mn]})}},Kn=e=>{const s={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(a=>typeof a=="string"?a==="*"?()=>a:l=>a===l?l:null:typeof a=="function"?a:l=>a.includes(l)?l:null)(s.origin),i=(a=>typeof a=="function"?a:Array.isArray(a)?()=>a:()=>[])(s.allowMethods);return async function(l,c){var h;function o(f,m){l.res.headers.set(f,m)}const d=n(l.req.header("origin")||"",l);if(d&&o("Access-Control-Allow-Origin",d),s.origin!=="*"){const f=l.req.header("Vary");f?o("Vary",f):o("Vary","Origin")}if(s.credentials&&o("Access-Control-Allow-Credentials","true"),(h=s.exposeHeaders)!=null&&h.length&&o("Access-Control-Expose-Headers",s.exposeHeaders.join(",")),l.req.method==="OPTIONS"){s.maxAge!=null&&o("Access-Control-Max-Age",s.maxAge.toString());const f=i(l.req.header("origin")||"",l);f.length&&o("Access-Control-Allow-Methods",f.join(","));let m=s.allowHeaders;if(!(m!=null&&m.length)){const y=l.req.header("Access-Control-Request-Headers");y&&(m=y.split(/\s*,\s*/))}return m!=null&&m.length&&(o("Access-Control-Allow-Headers",m.join(",")),l.res.headers.append("Vary","Access-Control-Request-Headers")),l.res.headers.delete("Content-Length"),l.res.headers.delete("Content-Type"),new Response(null,{headers:l.res.headers,status:204,statusText:"No Content"})}await c()}},$n=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,xr=(e,r=Wn)=>{const s=/\.([a-zA-Z0-9]+?)$/,n=e.match(s);if(!n)return;let i=r[n[1]];return i&&i.startsWith("text")&&(i+="; charset=utf-8"),i},Un={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Wn=Un,Hn=(...e)=>{let r=e.filter(i=>i!=="").join("/");r=r.replace(new RegExp("(?<=\\/)\\/+","g"),"");const s=r.split("/"),n=[];for(const i of s)i===".."&&n.length>0&&n.at(-1)!==".."?n.pop():i!=="."&&n.push(i);return n.join("/")||"."},Es={br:".br",zstd:".zst",gzip:".gz"},Jn=Object.keys(Es),Fn="index.html",zn=e=>{const r=e.root??"./",s=e.path,n=e.join??Hn;return async(i,a)=>{var h,f,m,y;if(i.finalized)return a();let l;if(e.path)l=e.path;else try{if(l=decodeURIComponent(i.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(l))throw new Error}catch{return await((h=e.onNotFound)==null?void 0:h.call(e,i.req.path,i)),a()}let c=n(r,!s&&e.rewriteRequestPath?e.rewriteRequestPath(l):l);e.isDir&&await e.isDir(c)&&(c=n(c,Fn));const o=e.getContent;let d=await o(c,i);if(d instanceof Response)return i.newResponse(d.body,d);if(d){const x=e.mimes&&xr(c,e.mimes)||xr(c);if(i.header("Content-Type",x||"application/octet-stream"),e.precompressed&&(!x||$n.test(x))){const b=new Set((f=i.req.header("Accept-Encoding"))==null?void 0:f.split(",").map(v=>v.trim()));for(const v of Jn){if(!b.has(v))continue;const E=await o(c+Es[v],i);if(E){d=E,i.header("Content-Encoding",v),i.header("Vary","Accept-Encoding",{append:!0});break}}}return await((m=e.onFound)==null?void 0:m.call(e,c,i)),i.body(d)}await((y=e.onNotFound)==null?void 0:y.call(e,c,i)),await a()}},Gn=async(e,r)=>{let s;r&&r.manifest?typeof r.manifest=="string"?s=JSON.parse(r.manifest):s=r.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?s=JSON.parse(__STATIC_CONTENT_MANIFEST):s=__STATIC_CONTENT_MANIFEST;let n;r&&r.namespace?n=r.namespace:n=__STATIC_CONTENT;const i=s[e]||e;if(!i)return null;const a=await n.get(i,{type:"stream"});return a||null},qn=e=>async function(s,n){return zn({...e,getContent:async a=>Gn(a,{manifest:e.manifest,namespace:e.namespace?e.namespace:s.env?s.env.__STATIC_CONTENT:void 0})})(s,n)},Vn=e=>qn(e);const ft=new TextEncoder,Ge=new TextDecoder;function Zn(...e){const r=e.reduce((i,{length:a})=>i+a,0),s=new Uint8Array(r);let n=0;for(const i of e)s.set(i,n),n+=i.length;return s}function Yn(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const r=atob(e),s=new Uint8Array(r.length);for(let n=0;n<r.length;n++)s[n]=r.charCodeAt(n);return s}function Fe(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:Ge.decode(e),{alphabet:"base64url"});let r=e;r instanceof Uint8Array&&(r=Ge.decode(r)),r=r.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Yn(r)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class _ extends Error{constructor(s,n){var i;super(s,n);p(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(i=Error.captureStackTrace)==null||i.call(Error,this,this.constructor)}}p(_,"code","ERR_JOSE_GENERIC");class K extends _{constructor(s,n,i="unspecified",a="unspecified"){super(s,{cause:{claim:i,reason:a,payload:n}});p(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");p(this,"claim");p(this,"reason");p(this,"payload");this.claim=i,this.reason=a,this.payload=n}}p(K,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class Ft extends _{constructor(s,n,i="unspecified",a="unspecified"){super(s,{cause:{claim:i,reason:a,payload:n}});p(this,"code","ERR_JWT_EXPIRED");p(this,"claim");p(this,"reason");p(this,"payload");this.claim=i,this.reason=a,this.payload=n}}p(Ft,"code","ERR_JWT_EXPIRED");class Ss extends _{constructor(){super(...arguments);p(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}p(Ss,"code","ERR_JOSE_ALG_NOT_ALLOWED");class z extends _{constructor(){super(...arguments);p(this,"code","ERR_JOSE_NOT_SUPPORTED")}}p(z,"code","ERR_JOSE_NOT_SUPPORTED");class j extends _{constructor(){super(...arguments);p(this,"code","ERR_JWS_INVALID")}}p(j,"code","ERR_JWS_INVALID");class rr extends _{constructor(){super(...arguments);p(this,"code","ERR_JWT_INVALID")}}p(rr,"code","ERR_JWT_INVALID");class sr extends _{constructor(){super(...arguments);p(this,"code","ERR_JWKS_INVALID")}}p(sr,"code","ERR_JWKS_INVALID");class nr extends _{constructor(s="no applicable key found in the JSON Web Key Set",n){super(s,n);p(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}p(nr,"code","ERR_JWKS_NO_MATCHING_KEY");var Jr,Fr;class As extends(Fr=_,Jr=Symbol.asyncIterator,Fr){constructor(s="multiple matching keys found in the JSON Web Key Set",n){super(s,n);p(this,Jr);p(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}p(As,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class ks extends _{constructor(s="request timed out",n){super(s,n);p(this,"code","ERR_JWKS_TIMEOUT")}}p(ks,"code","ERR_JWKS_TIMEOUT");class Cs extends _{constructor(s="signature verification failed",n){super(s,n);p(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}p(Cs,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function q(e,r="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${r} must be ${e}`)}function Ue(e,r){return e.name===r}function Lt(e){return parseInt(e.name.slice(4),10)}function Xn(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Qn(e,r){if(!e.usages.includes(r))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${r}.`)}function ei(e,r,s){switch(r){case"HS256":case"HS384":case"HS512":{if(!Ue(e.algorithm,"HMAC"))throw q("HMAC");const n=parseInt(r.slice(2),10);if(Lt(e.algorithm.hash)!==n)throw q(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Ue(e.algorithm,"RSASSA-PKCS1-v1_5"))throw q("RSASSA-PKCS1-v1_5");const n=parseInt(r.slice(2),10);if(Lt(e.algorithm.hash)!==n)throw q(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Ue(e.algorithm,"RSA-PSS"))throw q("RSA-PSS");const n=parseInt(r.slice(2),10);if(Lt(e.algorithm.hash)!==n)throw q(`SHA-${n}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Ue(e.algorithm,"Ed25519"))throw q("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Ue(e.algorithm,"ECDSA"))throw q("ECDSA");const n=Xn(r);if(e.algorithm.namedCurve!==n)throw q(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Qn(e,s)}function Ps(e,r,...s){var n;if(s=s.filter(Boolean),s.length>2){const i=s.pop();e+=`one of type ${s.join(", ")}, or ${i}.`}else s.length===2?e+=`one of type ${s[0]} or ${s[1]}.`:e+=`of type ${s[0]}.`;return r==null?e+=` Received ${r}`:typeof r=="function"&&r.name?e+=` Received function ${r.name}`:typeof r=="object"&&r!=null&&(n=r.constructor)!=null&&n.name&&(e+=` Received an instance of ${r.constructor.name}`),e}const ti=(e,...r)=>Ps("Key must be ",e,...r);function Rs(e,r,...s){return Ps(`Key for the ${e} algorithm must be `,r,...s)}function Is(e){return(e==null?void 0:e[Symbol.toStringTag])==="CryptoKey"}function Ts(e){return(e==null?void 0:e[Symbol.toStringTag])==="KeyObject"}const js=e=>Is(e)||Ts(e),ri=(...e)=>{const r=e.filter(Boolean);if(r.length===0||r.length===1)return!0;let s;for(const n of r){const i=Object.keys(n);if(!s||s.size===0){s=new Set(i);continue}for(const a of i){if(s.has(a))return!1;s.add(a)}}return!0};function si(e){return typeof e=="object"&&e!==null}const he=e=>{if(!si(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let r=e;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r},ni=(e,r)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:s}=r.algorithm;if(typeof s!="number"||s<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function ii(e){let r,s;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},s=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},s=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},s=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":r={name:"ECDSA",namedCurve:"P-256"},s=e.d?["sign"]:["verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},s=e.d?["sign"]:["verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},s=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:"ECDH",namedCurve:e.crv},s=e.d?["deriveBits"]:[];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":r={name:"Ed25519"},s=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:e.crv},s=e.d?["deriveBits"]:[];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new z('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:r,keyUsages:s}}const Bs=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:r,keyUsages:s}=ii(e),n={...e};return delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,r,e.ext??!e.d,e.key_ops??s)};async function ai(e,r,s){if(!he(e))throw new TypeError("JWK must be an object");let n;switch(r??(r=e.alg),n??(n=e.ext),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Fe(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new z('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Bs({...e,alg:r,ext:n});default:throw new z('Unsupported "kty" (Key Type) Parameter value')}}const li=(e,r,s,n,i)=>{if(i.crit!==void 0&&(n==null?void 0:n.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(l=>typeof l!="string"||l.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let a;s!==void 0?a=new Map([...Object.entries(s),...r.entries()]):a=r;for(const l of n.crit){if(!a.has(l))throw new z(`Extension Header Parameter "${l}" is not recognized`);if(i[l]===void 0)throw new e(`Extension Header Parameter "${l}" is missing`);if(a.get(l)&&n[l]===void 0)throw new e(`Extension Header Parameter "${l}" MUST be integrity protected`)}return new Set(n.crit)},ci=(e,r)=>{if(r!==void 0&&(!Array.isArray(r)||r.some(s=>typeof s!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(r)return new Set(r)};function ir(e){return he(e)&&typeof e.kty=="string"}function oi(e){return e.kty!=="oct"&&typeof e.d=="string"}function di(e){return e.kty!=="oct"&&typeof e.d>"u"}function ui(e){return e.kty==="oct"&&typeof e.k=="string"}let Re;const vr=async(e,r,s,n=!1)=>{Re||(Re=new WeakMap);let i=Re.get(e);if(i!=null&&i[s])return i[s];const a=await Bs({...r,alg:s});return n&&Object.freeze(e),i?i[s]=a:Re.set(e,{[s]:a}),a},hi=(e,r)=>{var l;Re||(Re=new WeakMap);let s=Re.get(e);if(s!=null&&s[r])return s[r];const n=e.type==="public",i=!!n;let a;if(e.asymmetricKeyType==="x25519"){switch(r){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}a=e.toCryptoKey(e.asymmetricKeyType,i,n?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(r!=="EdDSA"&&r!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,i,[n?"verify":"sign"])}if(e.asymmetricKeyType==="rsa"){let c;switch(r){case"RSA-OAEP":c="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":c="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":c="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":c="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(r.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:c},i,n?["encrypt"]:["decrypt"]);a=e.toCryptoKey({name:r.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:c},i,[n?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const o=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((l=e.asymmetricKeyDetails)==null?void 0:l.namedCurve);if(!o)throw new TypeError("given KeyObject instance cannot be used for this algorithm");r==="ES256"&&o==="P-256"&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:o},i,[n?"verify":"sign"])),r==="ES384"&&o==="P-384"&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:o},i,[n?"verify":"sign"])),r==="ES512"&&o==="P-521"&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:o},i,[n?"verify":"sign"])),r.startsWith("ECDH-ES")&&(a=e.toCryptoKey({name:"ECDH",namedCurve:o},i,n?[]:["deriveBits"]))}if(!a)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return s?s[r]=a:Re.set(e,{[r]:a}),a},fi=async(e,r)=>{if(e instanceof Uint8Array||Is(e))return e;if(Ts(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return hi(e,r)}catch(n){if(n instanceof TypeError)throw n}let s=e.export({format:"jwk"});return vr(e,s,r)}if(ir(e))return e.k?Fe(e.k):vr(e,e,r,!0);throw new Error("unreachable")},Pe=e=>e==null?void 0:e[Symbol.toStringTag],zt=(e,r,s)=>{var n,i;if(r.use!==void 0){let a;switch(s){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc";break}if(r.use!==a)throw new TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(r.alg!==void 0&&r.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(r.key_ops)){let a;switch(!0){case s==="verify":case e==="dir":case e.includes("CBC-HS"):a=s;break;case e.startsWith("PBES2"):a="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?a="unwrapKey":a=s;break;case s==="encrypt":a="wrapKey";break;case s==="decrypt":a=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(a&&((i=(n=r.key_ops)==null?void 0:n.includes)==null?void 0:i.call(n,a))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${a}" when present`)}return!0},mi=(e,r,s)=>{if(!(r instanceof Uint8Array)){if(ir(r)){if(ui(r)&&zt(e,r,s))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!js(r))throw new TypeError(Rs(e,r,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(r.type!=="secret")throw new TypeError(`${Pe(r)} instances for symmetric algorithms must be of type "secret"`)}},pi=(e,r,s)=>{if(ir(r))switch(s){case"decrypt":case"sign":if(oi(r)&&zt(e,r,s))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(di(r)&&zt(e,r,s))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!js(r))throw new TypeError(Rs(e,r,"CryptoKey","KeyObject","JSON Web Key"));if(r.type==="secret")throw new TypeError(`${Pe(r)} instances for asymmetric algorithms must not be of type "secret"`);if(r.type==="public")switch(s){case"sign":throw new TypeError(`${Pe(r)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${Pe(r)} instances for asymmetric algorithm decryption must be of type "private"`)}if(r.type==="private")switch(s){case"verify":throw new TypeError(`${Pe(r)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${Pe(r)} instances for asymmetric algorithm encryption must be of type "public"`)}},bi=(e,r,s)=>{e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(e)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(e)?mi(e,r,s):pi(e,r,s)},gi=(e,r)=>{const s=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:s,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:s,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:s,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:s,name:"ECDSA",namedCurve:r.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new z(`alg ${e} is not supported either by JOSE or your javascript runtime`)}},yi=async(e,r,s)=>{if(r instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(ti(r,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",r,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[s])}return ei(r,e,s),r},xi=async(e,r,s,n)=>{const i=await yi(e,r,"verify");ni(e,i);const a=gi(e,i.algorithm);try{return await crypto.subtle.verify(a,i,s,n)}catch{return!1}};async function vi(e,r,s){if(!he(e))throw new j("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new j('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new j("JWS Protected Header incorrect type");if(e.payload===void 0)throw new j("JWS Payload missing");if(typeof e.signature!="string")throw new j("JWS Signature missing or incorrect type");if(e.header!==void 0&&!he(e.header))throw new j("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const v=Fe(e.protected);n=JSON.parse(Ge.decode(v))}catch{throw new j("JWS Protected Header is invalid")}if(!ri(n,e.header))throw new j("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...n,...e.header},a=li(j,new Map([["b64",!0]]),s==null?void 0:s.crit,n,i);let l=!0;if(a.has("b64")&&(l=n.b64,typeof l!="boolean"))throw new j('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=i;if(typeof c!="string"||!c)throw new j('JWS "alg" (Algorithm) Header Parameter missing or invalid');const o=s&&ci("algorithms",s.algorithms);if(o&&!o.has(c))throw new Ss('"alg" (Algorithm) Header Parameter value not allowed');if(l){if(typeof e.payload!="string")throw new j("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new j("JWS Payload must be a string or an Uint8Array instance");let d=!1;typeof r=="function"&&(r=await r(n,e),d=!0),bi(c,r,"verify");const h=Zn(ft.encode(e.protected??""),ft.encode("."),typeof e.payload=="string"?ft.encode(e.payload):e.payload);let f;try{f=Fe(e.signature)}catch{throw new j("Failed to base64url decode the signature")}const m=await fi(r,c);if(!await xi(c,m,f,h))throw new Cs;let x;if(l)try{x=Fe(e.payload)}catch{throw new j("Failed to base64url decode the payload")}else typeof e.payload=="string"?x=ft.encode(e.payload):x=e.payload;const b={payload:x};return e.protected!==void 0&&(b.protectedHeader=n),e.header!==void 0&&(b.unprotectedHeader=e.header),d?{...b,key:m}:b}async function wi(e,r,s){if(e instanceof Uint8Array&&(e=Ge.decode(e)),typeof e!="string")throw new j("Compact JWS must be a string or Uint8Array");const{0:n,1:i,2:a,length:l}=e.split(".");if(l!==3)throw new j("Invalid Compact JWS");const c=await vi({payload:i,protected:n,signature:a},r,s),o={payload:c.payload,protectedHeader:c.protectedHeader};return typeof r=="function"?{...o,key:c.key}:o}const Ei=e=>Math.floor(e.getTime()/1e3),Os=60,Ls=Os*60,ar=Ls*24,Si=ar*7,Ai=ar*365.25,ki=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,wr=e=>{const r=ki.exec(e);if(!r||r[4]&&r[1])throw new TypeError("Invalid time period format");const s=parseFloat(r[2]),n=r[3].toLowerCase();let i;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(s);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(s*Os);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(s*Ls);break;case"day":case"days":case"d":i=Math.round(s*ar);break;case"week":case"weeks":case"w":i=Math.round(s*Si);break;default:i=Math.round(s*Ai);break}return r[1]==="-"||r[4]==="ago"?-i:i},Er=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,Ci=(e,r)=>typeof e=="string"?r.includes(e):Array.isArray(e)?r.some(Set.prototype.has.bind(new Set(e))):!1;function Pi(e,r,s={}){let n;try{n=JSON.parse(Ge.decode(r))}catch{}if(!he(n))throw new rr("JWT Claims Set must be a top-level JSON object");const{typ:i}=s;if(i&&(typeof e.typ!="string"||Er(e.typ)!==Er(i)))throw new K('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:a=[],issuer:l,subject:c,audience:o,maxTokenAge:d}=s,h=[...a];d!==void 0&&h.push("iat"),o!==void 0&&h.push("aud"),c!==void 0&&h.push("sub"),l!==void 0&&h.push("iss");for(const x of new Set(h.reverse()))if(!(x in n))throw new K(`missing required "${x}" claim`,n,x,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(n.iss))throw new K('unexpected "iss" claim value',n,"iss","check_failed");if(c&&n.sub!==c)throw new K('unexpected "sub" claim value',n,"sub","check_failed");if(o&&!Ci(n.aud,typeof o=="string"?[o]:o))throw new K('unexpected "aud" claim value',n,"aud","check_failed");let f;switch(typeof s.clockTolerance){case"string":f=wr(s.clockTolerance);break;case"number":f=s.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:m}=s,y=Ei(m||new Date);if((n.iat!==void 0||d)&&typeof n.iat!="number")throw new K('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new K('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>y+f)throw new K('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new K('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=y-f)throw new Ft('"exp" claim timestamp check failed',n,"exp","check_failed")}if(d){const x=y-n.iat,b=typeof d=="number"?d:wr(d);if(x-f>b)throw new Ft('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(x<0-f)throw new K('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}async function Ri(e,r,s){var l;const n=await wi(e,r,s);if((l=n.protectedHeader.crit)!=null&&l.includes("b64")&&n.protectedHeader.b64===!1)throw new rr("JWTs MUST NOT use unencoded payload");const a={payload:Pi(n.protectedHeader,n.payload,s),protectedHeader:n.protectedHeader};return typeof r=="function"?{...a,key:n.key}:a}function Ii(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new z('Unsupported "alg" value for a JSON Web Key Set')}}function Ti(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(ji)}function ji(e){return he(e)}var Le,rt;class Bi{constructor(r){w(this,Le);w(this,rt,new WeakMap);if(!Ti(r))throw new sr("JSON Web Key Set malformed");g(this,Le,structuredClone(r))}jwks(){return u(this,Le)}async getKey(r,s){const{alg:n,kid:i}={...r,...s==null?void 0:s.header},a=Ii(n),l=u(this,Le).keys.filter(d=>{let h=a===d.kty;if(h&&typeof i=="string"&&(h=i===d.kid),h&&typeof d.alg=="string"&&(h=n===d.alg),h&&typeof d.use=="string"&&(h=d.use==="sig"),h&&Array.isArray(d.key_ops)&&(h=d.key_ops.includes("verify")),h)switch(n){case"ES256":h=d.crv==="P-256";break;case"ES384":h=d.crv==="P-384";break;case"ES512":h=d.crv==="P-521";break;case"Ed25519":case"EdDSA":h=d.crv==="Ed25519";break}return h}),{0:c,length:o}=l;if(o===0)throw new nr;if(o!==1){const d=new As,h=u(this,rt);throw d[Symbol.asyncIterator]=async function*(){for(const f of l)try{yield await Sr(h,f,n)}catch{}},d}return Sr(u(this,rt),c,n)}}Le=new WeakMap,rt=new WeakMap;async function Sr(e,r,s){const n=e.get(r)||e.set(r,{}).get(r);if(n[s]===void 0){const i=await ai({...r,ext:!0},s);if(i instanceof Uint8Array||i.type!=="public")throw new sr("JSON Web Key Set members must be public keys");n[s]=i}return n[s]}function Ar(e){const r=new Bi(e),s=async(n,i)=>r.getKey(n,i);return Object.defineProperties(s,{jwks:{value:()=>structuredClone(r.jwks()),enumerable:!1,configurable:!1,writable:!1}}),s}function Oi(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Gt;var pt,zr;(typeof navigator>"u"||!((zr=(pt=navigator.userAgent)==null?void 0:pt.startsWith)!=null&&zr.call(pt,"Mozilla/5.0 ")))&&(Gt="jose/v6.0.13");const Li=Symbol();async function Di(e,r,s,n=fetch){const i=await n(e,{method:"GET",signal:s,redirect:"manual",headers:r}).catch(a=>{throw a.name==="TimeoutError"?new ks:a});if(i.status!==200)throw new _("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await i.json()}catch{throw new _("Failed to parse the JSON Web Key Set HTTP response as JSON")}}const Dt=Symbol();function _i(e,r){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=r||!("jwks"in e)||!he(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,he))}var st,nt,it,De,ee,J,F,at,te,re;class Ni{constructor(r,s){w(this,st);w(this,nt);w(this,it);w(this,De);w(this,ee);w(this,J);w(this,F);w(this,at);w(this,te);w(this,re);if(!(r instanceof URL))throw new TypeError("url must be an instance of URL");g(this,st,new URL(r.href)),g(this,nt,typeof(s==null?void 0:s.timeoutDuration)=="number"?s==null?void 0:s.timeoutDuration:5e3),g(this,it,typeof(s==null?void 0:s.cooldownDuration)=="number"?s==null?void 0:s.cooldownDuration:3e4),g(this,De,typeof(s==null?void 0:s.cacheMaxAge)=="number"?s==null?void 0:s.cacheMaxAge:6e5),g(this,F,new Headers(s==null?void 0:s.headers)),Gt&&!u(this,F).has("User-Agent")&&u(this,F).set("User-Agent",Gt),u(this,F).has("accept")||(u(this,F).set("accept","application/json"),u(this,F).append("accept","application/jwk-set+json")),g(this,at,s==null?void 0:s[Li]),(s==null?void 0:s[Dt])!==void 0&&(g(this,re,s==null?void 0:s[Dt]),_i(s==null?void 0:s[Dt],u(this,De))&&(g(this,ee,u(this,re).uat),g(this,te,Ar(u(this,re).jwks))))}pendingFetch(){return!!u(this,J)}coolingDown(){return typeof u(this,ee)=="number"?Date.now()<u(this,ee)+u(this,it):!1}fresh(){return typeof u(this,ee)=="number"?Date.now()<u(this,ee)+u(this,De):!1}jwks(){var r;return(r=u(this,te))==null?void 0:r.jwks()}async getKey(r,s){(!u(this,te)||!this.fresh())&&await this.reload();try{return await u(this,te).call(this,r,s)}catch(n){if(n instanceof nr&&this.coolingDown()===!1)return await this.reload(),u(this,te).call(this,r,s);throw n}}async reload(){u(this,J)&&Oi()&&g(this,J,void 0),u(this,J)||g(this,J,Di(u(this,st).href,u(this,F),AbortSignal.timeout(u(this,nt)),u(this,at)).then(r=>{g(this,te,Ar(r)),u(this,re)&&(u(this,re).uat=Date.now(),u(this,re).jwks=r),g(this,ee,Date.now()),g(this,J,void 0)}).catch(r=>{throw g(this,J,void 0),r})),await u(this,J)}}st=new WeakMap,nt=new WeakMap,it=new WeakMap,De=new WeakMap,ee=new WeakMap,J=new WeakMap,F=new WeakMap,at=new WeakMap,te=new WeakMap,re=new WeakMap;function Mi(e,r){const s=new Ni(e,r),n=async(i,a)=>s.getKey(i,a);return Object.defineProperties(n,{coolingDown:{get:()=>s.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>s.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>s.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>s.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>s.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}var qe="_hp",Ki={Change:"Input",DoubleClick:"DblClick"},$i={svg:"2000/svg",math:"1998/Math/MathML"},Ve=[],qt=new WeakMap,Ne=void 0,Ui=()=>Ne,V=e=>"t"in e,_t={onClick:["click",!1]},kr=e=>{if(!e.startsWith("on"))return;if(_t[e])return _t[e];const r=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(r){const[,s,n]=r;return _t[e]=[(Ki[s]||s).toLowerCase(),!!n]}},Cr=(e,r)=>Ne&&e instanceof SVGElement&&/[A-Z]/.test(r)&&(r in e.style||r.match(/^(?:o|pai|str|u|ve)/))?r.replace(/([A-Z])/g,"-$1").toLowerCase():r,Wi=(e,r,s)=>{var n;r||(r={});for(let i in r){const a=r[i];if(i!=="children"&&(!s||s[i]!==a)){i=kt(i);const l=kr(i);if(l){if((s==null?void 0:s[i])!==a&&(s&&e.removeEventListener(l[0],s[i],l[1]),a!=null)){if(typeof a!="function")throw new Error(`Event handler for "${i}" is not a function`);e.addEventListener(l[0],a,l[1])}}else if(i==="dangerouslySetInnerHTML"&&a)e.innerHTML=a.__html;else if(i==="ref"){let c;typeof a=="function"?c=a(e)||(()=>a(null)):a&&"current"in a&&(a.current=e,c=()=>a.current=null),qt.set(e,c)}else if(i==="style"){const c=e.style;typeof a=="string"?c.cssText=a:(c.cssText="",a!=null&&rs(a,c.setProperty.bind(c)))}else{if(i==="value"){const o=e.nodeName;if(o==="INPUT"||o==="TEXTAREA"||o==="SELECT"){if(e.value=a==null||a===!1?null:a,o==="TEXTAREA"){e.textContent=a;continue}else if(o==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(i==="checked"&&e.nodeName==="INPUT"||i==="selected"&&e.nodeName==="OPTION")&&(e[i]=a);const c=Cr(e,i);a==null||a===!1?e.removeAttribute(c):a===!0?e.setAttribute(c,""):typeof a=="string"||typeof a=="number"?e.setAttribute(c,a):e.setAttribute(c,a.toString())}}}if(s)for(let i in s){const a=s[i];if(i!=="children"&&!(i in r)){i=kt(i);const l=kr(i);l?e.removeEventListener(l[0],a,l[1]):i==="ref"?(n=qt.get(e))==null||n():e.removeAttribute(Cr(e,i))}}},Hi=(e,r)=>{r[R][0]=0,Ve.push([e,r]);const s=r.tag[Yt]||r.tag,n=s.defaultProps?{...s.defaultProps,...r.props}:r.props;try{return[s.call(null,n)]}finally{Ve.pop()}},Ds=(e,r,s,n,i)=>{var a,l;(a=e.vR)!=null&&a.length&&(n.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((l=e[R][1][Ks])==null||l.forEach(c=>i.push(c))),e.vC.forEach(c=>{var o;if(V(c))s.push(c);else if(typeof c.tag=="function"||c.tag===""){c.c=r;const d=s.length;if(Ds(c,r,s,n,i),c.s){for(let h=d;h<s.length;h++)s[h].s=!0;c.s=!1}}else s.push(c),(o=c.vR)!=null&&o.length&&(n.push(...c.vR),delete c.vR)})},Ji=e=>{for(;;e=e.tag===qe||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==qe&&e.e)return e.e}},_s=e=>{var r,s,n,i,a,l;V(e)||((s=(r=e[R])==null?void 0:r[1][Ks])==null||s.forEach(c=>{var o;return(o=c[2])==null?void 0:o.call(c)}),(n=qt.get(e.e))==null||n(),e.p===2&&((i=e.vC)==null||i.forEach(c=>c.p=2)),(a=e.vC)==null||a.forEach(_s)),e.p||((l=e.e)==null||l.remove(),delete e.e),typeof e.tag=="function"&&(We.delete(e),Et.delete(e),delete e[R][3],e.a=!0)},Ns=(e,r,s)=>{e.c=r,Ms(e,r,s)},Pr=(e,r)=>{if(r){for(let s=0,n=e.length;s<n;s++)if(e[s]===r)return s}},Rr=Symbol(),Ms=(e,r,s)=>{var d;const n=[],i=[],a=[];Ds(e,r,n,i,a),i.forEach(_s);const l=s?void 0:r.childNodes;let c,o=null;if(s)c=-1;else if(!l.length)c=0;else{const h=Pr(l,Ji(e.nN));h!==void 0?(o=l[h],c=h):c=Pr(l,(d=n.find(f=>f.tag!==qe&&f.e))==null?void 0:d.e)??-1,c===-1&&(s=!0)}for(let h=0,f=n.length;h<f;h++,c++){const m=n[h];let y;if(m.s&&m.e)y=m.e,m.s=!1;else{const x=s||!m.e;V(m)?(m.e&&m.d&&(m.e.textContent=m.t),m.d=!1,y=m.e||(m.e=document.createTextNode(m.t))):(y=m.e||(m.e=m.n?document.createElementNS(m.n,m.tag):document.createElement(m.tag)),Wi(y,m.props,m.pP),Ms(m,y,x))}m.tag===qe?c--:s?y.parentNode||r.appendChild(y):l[c]!==y&&l[c-1]!==y&&(l[c+1]===y?r.appendChild(l[c]):r.insertBefore(y,o||l[c]||null))}if(e.pP&&delete e.pP,a.length){const h=[],f=[];a.forEach(([,m,,y,x])=>{m&&h.push(m),y&&f.push(y),x==null||x()}),h.forEach(m=>m()),f.length&&requestAnimationFrame(()=>{f.forEach(m=>m())})}},Fi=(e,r)=>!!(e&&e.length===r.length&&e.every((s,n)=>s[1]===r[n][1])),Et=new WeakMap,Vt=(e,r,s)=>{var a,l,c,o,d,h;const n=!s&&r.pC;s&&(r.pC||(r.pC=r.vC));let i;try{s||(s=typeof r.tag=="function"?Hi(e,r):lt(r.props.children)),((a=s[0])==null?void 0:a.tag)===""&&s[0][Ut]&&(i=s[0][Ut],e[5].push([e,i,r]));const f=n?[...r.pC]:r.vC?[...r.vC]:void 0,m=[];let y;for(let x=0;x<s.length;x++){Array.isArray(s[x])&&s.splice(x,1,...s[x].flat());let b=zi(s[x]);if(b){typeof b.tag=="function"&&!b.tag[Yr]&&(_e.length>0&&(b[R][2]=_e.map(E=>[E,E.values.at(-1)])),(l=e[5])!=null&&l.length&&(b[R][3]=e[5].at(-1)));let v;if(f&&f.length){const E=f.findIndex(V(b)?S=>V(S):b.key!==void 0?S=>S.key===b.key&&S.tag===b.tag:S=>S.tag===b.tag);E!==-1&&(v=f[E],f.splice(E,1))}if(v)if(V(b))v.t!==b.t&&(v.t=b.t,v.d=!0),b=v;else{const E=v.pP=v.props;if(v.props=b.props,v.f||(v.f=b.f||r.f),typeof b.tag=="function"){const S=v[R][2];v[R][2]=b[R][2]||[],v[R][3]=b[R][3],!v.f&&((v.o||v)===b.o||(o=(c=v.tag)[Vs])!=null&&o.call(c,E,v.props))&&Fi(S,v[R][2])&&(v.s=!0)}b=v}else if(!V(b)&&Ne){const E=Ke(Ne);E&&(b.n=E)}if(!V(b)&&!b.s&&(Vt(e,b),delete b.f),m.push(b),y&&!y.s&&!b.s)for(let E=y;E&&!V(E);E=(d=E.vC)==null?void 0:d.at(-1))E.nN=b;y=b}}r.vR=n?[...r.vC,...f||[]]:f||[],r.vC=m,n&&delete r.pC}catch(f){if(r.f=!0,f===Rr){if(i)return;throw f}const[m,y,x]=((h=r[R])==null?void 0:h[3])||[];if(y){const b=()=>St([0,!1,e[2]],x),v=Et.get(x)||[];v.push(b),Et.set(x,v);const E=y(f,()=>{const S=Et.get(x);if(S){const C=S.indexOf(b);if(C!==-1)return S.splice(C,1),b()}});if(E){if(e[0]===1)e[1]=!0;else if(Vt(e,x,[E]),(y.length===1||e!==m)&&x.c){Ns(x,x.c,!1);return}throw Rr}}throw f}finally{i&&e[5].pop()}},zi=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[R]=[0,[]];else{const r=$i[e.tag];r&&(Ne||(Ne=Qr("")),e.props.children=[{tag:Ne,props:{value:e.n=`http://www.w3.org/${r}`,children:e.props.children}}])}return e}},Ir=(e,r)=>{var s,n;(s=r[R][2])==null||s.forEach(([i,a])=>{i.values.push(a)});try{Vt(e,r,void 0)}catch{return}if(r.a){delete r.a;return}(n=r[R][2])==null||n.forEach(([i])=>{i.values.pop()}),(e[0]!==1||!e[1])&&Ns(r,r.c,!1)},We=new WeakMap,Tr=[],St=async(e,r)=>{e[5]||(e[5]=[]);const s=We.get(r);s&&s[0](void 0);let n;const i=new Promise(a=>n=a);if(We.set(r,[n,()=>{e[2]?e[2](e,r,a=>{Ir(a,r)}).then(()=>n(r)):(Ir(e,r),n(r))}]),Tr.length)Tr.at(-1).add(r);else{await Promise.resolve();const a=We.get(r);a&&(We.delete(r),a[1]())}return i},Gi=(e,r,s)=>({tag:qe,props:{children:e},key:s,e:r,p:1}),Nt=0,Ks=1,Mt=2,Kt=3,$t=new WeakMap,$s=(e,r)=>!e||!r||e.length!==r.length||r.some((s,n)=>s!==e[n]),qi=void 0,jr=[],Vi=e=>{var l;const r=()=>typeof e=="function"?e():e,s=Ve.at(-1);if(!s)return[r(),()=>{}];const[,n]=s,i=(l=n[R][1])[Nt]||(l[Nt]=[]),a=n[R][0]++;return i[a]||(i[a]=[r(),c=>{const o=qi,d=i[a];if(typeof c=="function"&&(c=c(d[0])),!Object.is(c,d[0]))if(d[0]=c,jr.length){const[h,f]=jr.at(-1);Promise.all([h===3?n:St([h,!1,o],n),f]).then(([m])=>{if(!m||!(h===2||h===3))return;const y=m.vC;requestAnimationFrame(()=>{setTimeout(()=>{y===m.vC&&St([h===3?1:0,!1,o],m)})})})}else St([0,!1,o],n)}])},lr=(e,r)=>{var c;const s=Ve.at(-1);if(!s)return e;const[,n]=s,i=(c=n[R][1])[Mt]||(c[Mt]=[]),a=n[R][0]++,l=i[a];return $s(l==null?void 0:l[1],r)?i[a]=[e,r]:e=i[a][0],e},Zi=e=>{const r=$t.get(e);if(r){if(r.length===2)throw r[1];return r[0]}throw e.then(s=>$t.set(e,[s]),s=>$t.set(e,[void 0,s])),e},Yi=(e,r)=>{var c;const s=Ve.at(-1);if(!s)return e();const[,n]=s,i=(c=n[R][1])[Kt]||(c[Kt]=[]),a=n[R][0]++,l=i[a];return $s(l==null?void 0:l[1],r)&&(i[a]=[e(),r]),i[a][0]},Xi=Qr({pending:!1,data:null,method:null,action:null}),Br=new Set,Qi=e=>{Br.add(e),e.finally(()=>Br.delete(e))},cr=(e,r)=>Yi(()=>s=>{let n;e&&(typeof e=="function"?n=e(s)||(()=>{e(null)}):e&&"current"in e&&(e.current=s,n=()=>{e.current=null}));const i=r(s);return()=>{i==null||i(),n==null||n()}},[e]),Se=Object.create(null),mt=Object.create(null),dt=(e,r,s,n,i)=>{if(r!=null&&r.itemProp)return{tag:e,props:r,type:e,ref:r.ref};const a=document.head;let{onLoad:l,onError:c,precedence:o,blocking:d,...h}=r,f=null,m=!1;const y=bt[e];let x;if(y.length>0){const S=a.querySelectorAll(e);e:for(const C of S)for(const A of bt[e])if(C.getAttribute(A)===r[A]){f=C;break e}if(!f){const C=y.reduce((A,O)=>r[O]===void 0?A:`${A}-${O}-${r[O]}`,e);m=!mt[C],f=mt[C]||(mt[C]=(()=>{const A=document.createElement(e);for(const O of y)r[O]!==void 0&&A.setAttribute(O,r[O]),r.rel&&A.setAttribute("rel",r.rel);return A})())}}else x=a.querySelectorAll(e);o=n?o??"":void 0,n&&(h[gt]=o);const b=lr(S=>{if(y.length>0){let C=!1;for(const A of a.querySelectorAll(e)){if(C&&A.getAttribute(gt)!==o){a.insertBefore(S,A);return}A.getAttribute(gt)===o&&(C=!0)}a.appendChild(S)}else if(x){let C=!1;for(const A of x)if(A===S){C=!0;break}C||a.insertBefore(S,a.contains(x[0])?x[0]:a.querySelector(e)),x=void 0}},[o]),v=cr(r.ref,S=>{var O;const C=y[0];if(s===2&&(S.innerHTML=""),(m||x)&&b(S),!c&&!l)return;let A=Se[O=S.getAttribute(C)]||(Se[O]=new Promise((we,fe)=>{S.addEventListener("load",we),S.addEventListener("error",fe)}));l&&(A=A.then(l)),c&&(A=A.catch(c)),A.catch(()=>{})});if(i&&d==="render"){const S=bt[e][0];if(r[S]){const C=r[S],A=Se[C]||(Se[C]=new Promise((O,we)=>{b(f),f.addEventListener("load",O),f.addEventListener("error",we)}));Zi(A)}}const E={tag:e,type:e,props:{...h,ref:v},ref:v};return E.p=s,f&&(E.e=f),Gi(E,a)},ea=e=>{const r=Ui(),s=r&&Ke(r);return s!=null&&s.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:dt("title",e,void 0,!1,!1)},ta=e=>!e||["src","async"].some(r=>!e[r])?{tag:"script",props:e,type:"script",ref:e.ref}:dt("script",e,1,!1,!0),ra=e=>!e||!["href","precedence"].every(r=>r in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,dt("style",e,2,!0,!0)),sa=e=>!e||["onLoad","onError"].some(r=>r in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:dt("link",e,1,"precedence"in e,!0),na=e=>dt("meta",e,void 0,!1,!1),Us=Symbol(),ia=e=>{const{action:r,...s}=e;typeof r!="function"&&(s.action=r);const[n,i]=Vi([null,!1]),a=lr(async d=>{const h=d.isTrusted?r:d.detail[Us];if(typeof h!="function")return;d.preventDefault();const f=new FormData(d.target);i([f,!0]);const m=h(f);m instanceof Promise&&(Qi(m),await m),i([null,!0])},[]),l=cr(e.ref,d=>(d.addEventListener("submit",a),()=>{d.removeEventListener("submit",a)})),[c,o]=n;return n[1]=!1,{tag:Xi,props:{value:{pending:c!==null,data:c,method:c?"post":null,action:c?r:null},children:{tag:"form",props:{...s,ref:l},type:"form",ref:l}},f:o}},Ws=(e,{formAction:r,...s})=>{if(typeof r=="function"){const n=lr(i=>{i.preventDefault(),i.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Us]:r}}))},[]);s.ref=cr(s.ref,i=>(i.addEventListener("click",n),()=>{i.removeEventListener("click",n)}))}return{tag:e,props:s,type:e,ref:s.ref}},aa=e=>Ws("input",e),la=e=>Ws("button",e);Object.assign(Wt,{title:ea,script:ta,style:ra,link:sa,meta:na,form:ia,input:aa,button:la});Xt(null);new TextEncoder;var ca=Xt(null),oa=(e,r,s,n)=>(i,a)=>{const l="<!DOCTYPE html>",c=s?mr(d=>s(d,e),{Layout:r,...a},i):i,o=qs`${M(l)}${mr(ca.Provider,{value:e},c)}`;return e.html(o)},da=(e,r)=>function(n,i){const a=n.getLayout()??on;return e&&n.setLayout(l=>e({...l,Layout:a},n)),n.setRenderer(oa(n,a,e)),i()};const ua=da(({children:e})=>t("html",{lang:"ja",children:[t("head",{children:[t("meta",{charset:"UTF-8"}),t("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),t("title",{children:"バナスコAI - AI広告診断ツール"}),t("link",{href:"/static/style.css",rel:"stylesheet"}),t("link",{href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",rel:"stylesheet"})]}),t("body",{children:e})]})),ha=()=>t("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0a0f1c 0%, #1a1a2e 100%)",color:"white",padding:"2rem",textAlign:"center",fontFamily:"system-ui, -apple-system, sans-serif"},children:[t("h1",{style:{fontSize:"4rem",fontWeight:"bold",marginBottom:"2rem",background:"linear-gradient(45deg, #00f5ff, #8b5cf6, #ff6b9d)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textAlign:"center"},children:"🎯 バナスコAI"}),t("p",{style:{fontSize:"1.5rem",marginBottom:"3rem",color:"#a0a0a0"},children:["AI-Powered Banner Analysis",t("br",{}),"最先端AI技術でバナー広告を詳細分析"]}),t("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap",marginBottom:"3rem"},children:[t("a",{href:"/analysis",style:{padding:"1rem 2rem",background:"linear-gradient(45deg, #00f5ff, #8b5cf6)",color:"white",textDecoration:"none",borderRadius:"50px",fontWeight:"bold",fontSize:"1.1rem"},children:"🚀 AI診断を開始"}),t("a",{href:"/login",style:{padding:"1rem 2rem",background:"transparent",color:"#00f5ff",textDecoration:"none",border:"2px solid #00f5ff",borderRadius:"50px",fontWeight:"bold",fontSize:"1.1rem"},children:"👤 ログイン"})]}),t("div",{style:{background:"rgba(0, 245, 255, 0.1)",border:"1px solid rgba(0, 245, 255, 0.3)",borderRadius:"15px",padding:"2rem",maxWidth:"600px",margin:"0 auto"},children:[t("h3",{style:{color:"#00f5ff",marginBottom:"1rem"},children:"🎮 デモアカウント"}),t("p",{style:{fontFamily:"monospace",color:"#00f5ff",fontSize:"1.2rem"},children:"demo@banasuko.com / demo123456"}),t("p",{style:{color:"#a0a0a0",marginTop:"1rem"},children:"登録不要で即座に体験可能！"})]}),t("div",{style:{marginTop:"4rem"},children:[t("h2",{style:{color:"#8b5cf6",marginBottom:"2rem"},children:"主要機能"}),t("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"2rem",maxWidth:"1000px",margin:"0 auto"},children:[t("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"2rem",borderRadius:"15px",border:"1px solid rgba(0, 245, 255, 0.2)"},children:[t("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"📊"}),t("h3",{style:{color:"#00f5ff",marginBottom:"1rem"},children:"AI画像分析"}),t("p",{style:{color:"#a0a0a0"},children:"最新GPT-4 Vision技術でバナーを詳細分析"})]}),t("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"2rem",borderRadius:"15px",border:"1px solid rgba(139, 92, 246, 0.2)"},children:[t("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"⚖️"}),t("h3",{style:{color:"#8b5cf6",marginBottom:"1rem"},children:"A/B比較分析"}),t("p",{style:{color:"#a0a0a0"},children:"統計的有意性に基づいた勝者判定"})]}),t("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"2rem",borderRadius:"15px",border:"1px solid rgba(255, 107, 157, 0.2)"},children:[t("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"✨"}),t("h3",{style:{color:"#ff6b9d",marginBottom:"1rem"},children:"AIコピー生成"}),t("p",{style:{color:"#a0a0a0"},children:"効果的な広告コピーを自動生成"})]})]})]})]}),fa=()=>t("div",{class:"min-h-screen pt-20 pb-20",children:[t("div",{class:"max-w-md mx-auto px-4 sm:px-6 lg:px-8",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-3xl border border-cyber-blue/20 p-8 shadow-2xl animate-slide-up",children:[t("div",{class:"text-center mb-8",children:[t("div",{class:"w-20 h-20 bg-gradient-to-br from-cyber-blue to-cyber-purple rounded-2xl flex items-center justify-center mx-auto mb-6 animate-pulse-glow",children:t("i",{class:"fas fa-user-circle text-3xl text-white"})}),t("h1",{class:"text-3xl font-orbitron font-bold text-white mb-2",children:"ログイン"}),t("p",{class:"text-gray-400",children:"バナスコAIにアクセス"})]}),t("div",{id:"errorMessage",class:"hidden bg-red-500/10 border border-red-500/20 rounded-xl p-4",children:t("div",{class:"flex items-center text-red-400",children:[t("i",{class:"fas fa-exclamation-triangle mr-2"}),t("span",{id:"errorText",children:"エラーメッセージ"})]})}),t("div",{id:"successMessage",class:"hidden bg-green-500/10 border border-green-500/20 rounded-xl p-4",children:t("div",{class:"flex items-center text-green-400",children:[t("i",{class:"fas fa-check-circle mr-2"}),t("span",{id:"successText",children:"ログイン成功"})]})}),t("form",{id:"loginForm",class:"space-y-6",children:[t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:[t("i",{class:"fas fa-envelope mr-2 text-cyber-blue"}),"メールアドレス"]}),t("input",{type:"email",id:"email",name:"email",class:"w-full px-4 py-3 bg-navy-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-cyber-blue focus:ring-2 focus:ring-cyber-blue/20 transition-all duration-300",placeholder:"メールアドレスを入力",required:!0,autocomplete:"email"})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:[t("i",{class:"fas fa-lock mr-2 text-cyber-blue"}),"パスワード"]}),t("input",{type:"password",id:"password",name:"password",class:"w-full px-4 py-3 bg-navy-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-cyber-blue focus:ring-2 focus:ring-cyber-blue/20 transition-all duration-300",placeholder:"パスワードを入力",required:!0})]}),t("button",{type:"submit",id:"loginButton",class:"w-full py-3 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-xl text-white font-semibold hover:from-cyber-purple hover:to-cyber-pink transition-all duration-300 transform hover:scale-105 hover:shadow-lg hover:shadow-cyber-blue/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[t("span",{id:"loginButtonText",children:[t("i",{class:"fas fa-sign-in-alt mr-2"}),"ログイン"]}),t("span",{id:"loginSpinner",class:"hidden",children:[t("i",{class:"fas fa-spinner fa-spin mr-2"}),"ログイン中..."]})]})]}),t("div",{class:"my-8 flex items-center",children:[t("div",{class:"flex-1 border-t border-gray-600"}),t("span",{class:"px-4 text-gray-400 text-sm",children:"または"}),t("div",{class:"flex-1 border-t border-gray-600"})]}),t("div",{class:"bg-cyber-blue/10 border border-cyber-blue/20 rounded-xl p-6 mb-6",children:[t("h3",{class:"text-lg font-semibold text-cyber-blue mb-3",children:[t("i",{class:"fas fa-rocket mr-2"}),"デモアカウント"]}),t("p",{class:"text-gray-300 text-sm mb-4",children:"すぐにお試しいただけるデモアカウントをご用意しています"}),t("div",{class:"bg-navy-700/50 rounded-lg p-4 mb-4",children:t("div",{class:"grid grid-cols-2 gap-4 text-sm",children:[t("div",{children:[t("span",{class:"text-gray-400",children:"メールアドレス:"}),t("div",{class:"text-cyber-blue font-mono font-semibold",children:"demo@banasuko.com"})]}),t("div",{children:[t("span",{class:"text-gray-400",children:"パスワード:"}),t("div",{class:"text-cyber-blue font-mono font-semibold",children:"demo123456"})]})]})}),t("div",{class:"space-y-2",children:[t("button",{type:"button",id:"demoLoginBtn",class:"w-full py-2 bg-cyber-blue/20 border border-cyber-blue/30 rounded-lg text-cyber-blue font-medium hover:bg-cyber-blue/30 transition-all duration-300",children:[t("i",{class:"fas fa-magic mr-2"}),"デモアカウントでログイン"]}),t("button",{type:"button",id:"createDemoBtn",class:"w-full py-2 bg-cyber-pink/20 border border-cyber-pink/30 rounded-lg text-cyber-pink font-medium hover:bg-cyber-pink/30 transition-all duration-300",children:[t("i",{class:"fas fa-user-plus mr-2"}),"デモアカウント作成"]})]})]}),t("div",{class:"text-center",children:t("button",{id:"showRegisterForm",class:"text-cyber-pink hover:text-cyber-orange transition-colors duration-300",children:[t("i",{class:"fas fa-user-plus mr-2"}),"新規アカウント作成"]})})]}),t("div",{id:"registerForm",class:"hidden mt-8 bg-navy-800/50 backdrop-blur-lg rounded-3xl border border-cyber-pink/20 p-8 shadow-2xl animate-slide-up",children:[t("div",{class:"text-center mb-8",children:[t("div",{class:"w-20 h-20 bg-gradient-to-br from-cyber-pink to-cyber-orange rounded-2xl flex items-center justify-center mx-auto mb-6 animate-pulse-glow",children:t("i",{class:"fas fa-user-plus text-3xl text-white"})}),t("h1",{class:"text-3xl font-orbitron font-bold text-white mb-2",children:"新規登録"}),t("p",{class:"text-gray-400",children:"バナスコAIアカウント作成"})]}),t("form",{id:"registerFormElement",class:"space-y-6",children:[t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:[t("i",{class:"fas fa-envelope mr-2 text-cyber-pink"}),"メールアドレス"]}),t("input",{type:"email",id:"registerEmail",name:"email",class:"w-full px-4 py-3 bg-navy-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-cyber-pink focus:ring-2 focus:ring-cyber-pink/20 transition-all duration-300",placeholder:"メールアドレスを入力",required:!0})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:[t("i",{class:"fas fa-lock mr-2 text-cyber-pink"}),"パスワード"]}),t("input",{type:"password",id:"registerPassword",name:"password",class:"w-full px-4 py-3 bg-navy-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-cyber-pink focus:ring-2 focus:ring-cyber-pink/20 transition-all duration-300",placeholder:"パスワードを入力",required:!0})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:[t("i",{class:"fas fa-lock mr-2 text-cyber-pink"}),"パスワード（確認）"]}),t("input",{type:"password",id:"confirmPassword",name:"confirmPassword",class:"w-full px-4 py-3 bg-navy-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-cyber-pink focus:ring-2 focus:ring-cyber-pink/20 transition-all duration-300",placeholder:"パスワードを再入力",required:!0})]}),t("div",{id:"regErrorMessage",class:"hidden bg-red-500/10 border border-red-500/20 rounded-xl p-4",children:t("div",{class:"flex items-center text-red-400",children:[t("i",{class:"fas fa-exclamation-triangle mr-2"}),t("span",{id:"regErrorText",children:"エラーメッセージ"})]})}),t("div",{id:"regSuccessMessage",class:"hidden bg-green-500/10 border border-green-500/20 rounded-xl p-4",children:t("div",{class:"flex items-center text-green-400",children:[t("i",{class:"fas fa-check-circle mr-2"}),t("span",{id:"regSuccessText",children:"登録成功"})]})}),t("button",{type:"submit",id:"registerButton",class:"w-full py-3 bg-gradient-to-r from-cyber-pink to-cyber-orange rounded-xl text-white font-semibold hover:from-cyber-orange hover:to-yellow-500 transition-all duration-300 transform hover:scale-105 hover:shadow-lg hover:shadow-cyber-pink/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[t("span",{id:"registerButtonText",children:[t("i",{class:"fas fa-user-plus mr-2"}),"アカウント作成"]}),t("span",{id:"registerSpinner",class:"hidden",children:[t("i",{class:"fas fa-spinner fa-spin mr-2"}),"作成中..."]})]})]}),t("div",{class:"text-center mt-6",children:t("button",{id:"showLoginForm",class:"text-cyber-blue hover:text-cyber-purple transition-colors duration-300",children:[t("i",{class:"fas fa-arrow-left mr-2"}),"ログインに戻る"]})})]}),t("div",{class:"mt-12 bg-navy-800/30 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("h3",{class:"text-lg font-semibold text-white mb-4 text-center",children:[t("i",{class:"fas fa-star mr-2 text-cyber-blue"}),"ログイン後の機能"]}),t("div",{class:"space-y-3 text-sm",children:[t("div",{class:"flex items-center text-gray-300",children:[t("i",{class:"fas fa-chart-line mr-3 text-cyber-blue w-4"}),t("span",{children:"AI広告診断 - 詳細分析とスコアリング"})]}),t("div",{class:"flex items-center text-gray-300",children:[t("i",{class:"fas fa-balance-scale mr-3 text-cyber-green w-4"}),t("span",{children:"A/B比較分析 - 統計的有意性に基づく判定"})]}),t("div",{class:"flex items-center text-gray-300",children:[t("i",{class:"fas fa-magic mr-3 text-cyber-pink w-4"}),t("span",{children:"AIコピー生成 - 効果的な広告文の自動生成"})]}),t("div",{class:"flex items-center text-gray-300",children:[t("i",{class:"fas fa-chart-area mr-3 text-cyber-orange w-4"}),t("span",{children:"効果予測レポート - ROI・CVR改善予測"})]})]})]})]}),t("div",{class:"fixed inset-0 pointer-events-none overflow-hidden",children:[t("div",{class:"absolute top-1/4 left-1/4 w-2 h-2 bg-cyber-blue rounded-full animate-ping opacity-20"}),t("div",{class:"absolute top-3/4 right-1/4 w-1 h-1 bg-cyber-pink rounded-full animate-ping opacity-30 delay-1000"}),t("div",{class:"absolute bottom-1/4 left-1/3 w-1.5 h-1.5 bg-cyber-green rounded-full animate-ping opacity-25 delay-2000"})]}),t("script",{type:"module",src:"/static/js/firebase-auth.js"})]}),ma=()=>t("div",{class:"min-h-screen pt-20 pb-20",children:[t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[t("div",{class:"text-center mb-12 animate-slide-up",children:[t("h1",{class:"text-4xl md:text-5xl font-orbitron font-bold mb-4",children:t("span",{class:"bg-gradient-to-r from-cyber-blue to-cyber-green bg-clip-text text-transparent",children:"AI広告診断"})}),t("p",{class:"text-xl text-gray-300 max-w-3xl mx-auto",children:"最先端banaAI Vision技術が画像を詳細分析し、効果予測と改善提案を提供"})]}),t("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/20 p-6",children:[t("h3",{class:"text-xl font-semibold text-cyber-blue mb-6",children:[t("i",{class:"fas fa-user-cog mr-2"}),"基本情報"]}),t("div",{class:"space-y-4",children:[t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"表示名"}),t("input",{type:"text",id:"userName",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyber-blue transition-colors",placeholder:"あなたの名前"})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"ターゲット年代"}),t("select",{id:"ageGroup",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-blue transition-colors",children:[t("option",{value:"",children:"指定なし"}),t("option",{value:"10代",children:"10代"}),t("option",{value:"20代",children:"20代"}),t("option",{value:"30代",children:"30代"}),t("option",{value:"40代",children:"40代"}),t("option",{value:"50代",children:"50代"}),t("option",{value:"60代以上",children:"60代以上"})]})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"媒体"}),t("select",{id:"platform",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-blue transition-colors",onchange:"handlePlatformChange(this.value)",children:[t("option",{value:"",children:"媒体を選択してください"}),t("option",{value:"instagram-post",children:"Instagram（投稿）"}),t("option",{value:"instagram-ad",children:"Instagram（広告）"}),t("option",{value:"gdn",children:"Googleディスプレイ広告"}),t("option",{value:"yahoo",children:"Yahooディスプレイ広告"})]})]}),t("div",{id:"instagramAdType",class:"hidden",children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:[t("i",{class:"fab fa-instagram mr-2 text-cyber-pink"}),"Instagram広告タイプ"]}),t("select",{id:"instagramAdSubtype",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-pink transition-colors",children:[t("option",{value:"feed",children:"フィード広告"}),t("option",{value:"stories",children:"ストーリーズ広告"}),t("option",{value:"reels",children:"リール広告"}),t("option",{value:"explore",children:"発見タブ広告"})]})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"目的"}),t("select",{id:"purpose",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-blue transition-colors",children:[t("option",{value:"プロフィール誘導",children:"プロフィール誘導"}),t("option",{value:"リンククリック",children:"リンククリック"}),t("option",{value:"保存数増加",children:"保存数増加"}),t("option",{value:"インプレッション増加",children:"インプレッション増加"})]})]})]}),t("div",{id:"scoringTypeInfo",class:"mt-4 p-3 bg-navy-800/30 rounded-lg border border-gray-700/50",children:t("p",{class:"text-gray-400 text-sm font-medium",children:"📋 媒体を選択してください"})})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-green/20 p-6",children:[t("h3",{class:"text-xl font-semibold text-cyber-green mb-6",children:[t("i",{class:"fas fa-industry mr-2"}),"業界情報"]}),t("div",{class:"space-y-4",children:[t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"業界"}),t("select",{id:"industry",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-green transition-colors",children:[t("option",{value:"美容",children:"美容"}),t("option",{value:"飲食",children:"飲食"}),t("option",{value:"不動産",children:"不動産"}),t("option",{value:"子ども写真館",children:"子ども写真館"}),t("option",{value:"その他",children:"その他"})]})]}),t("div",{class:"flex items-center",children:[t("input",{type:"checkbox",id:"abMode",class:"w-4 h-4 text-cyber-green bg-navy-700 border-gray-600 rounded focus:ring-cyber-green/20 focus:ring-2"}),t("label",{for:"abMode",class:"ml-2 text-sm font-medium text-gray-300",children:"🆚 A/B比較分析モード"})]}),t("p",{class:"text-xs text-gray-400",children:"2つの画像を比較分析する場合にチェック"})]}),t("div",{class:"mt-6 p-4 bg-navy-700/30 rounded-lg border border-cyber-green/10",children:[t("h4",{class:"text-sm font-semibold text-cyber-green mb-3",children:[t("i",{class:"fas fa-clipboard-list mr-2"}),"採点基準"]}),t("div",{class:"space-y-2 text-xs",children:[t("div",{class:"flex items-center text-gray-400",children:[t("i",{class:"fas fa-bolt mr-2 text-cyber-blue w-4"}),t("span",{children:"瞬間伝達力 - 1秒で内容が理解できるか"})]}),t("div",{class:"flex items-center text-gray-400",children:[t("i",{class:"fas fa-eye mr-2 text-cyber-green w-4"}),t("span",{children:"視認性 - 文字が読みやすく配色が適切か"})]}),t("div",{class:"flex items-center text-gray-400",children:[t("i",{class:"fas fa-bullseye mr-2 text-cyber-pink w-4"}),t("span",{children:"行動喚起 - 明確なCTAでユーザーを誘導"})]}),t("div",{class:"flex items-center text-gray-400",children:[t("i",{class:"fas fa-sync mr-2 text-cyber-orange w-4"}),t("span",{children:"整合性 - 画像と文字内容の一致度"})]}),t("div",{class:"flex items-center text-gray-400",children:[t("i",{class:"fas fa-balance-scale mr-2 text-purple-400 w-4"}),t("span",{children:"情報バランス - 情報過多にならないか"})]})]})]})]})]}),t("div",{id:"singleUpload",class:"mb-12",children:t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-purple/20 p-8",children:[t("h3",{class:"text-2xl font-semibold text-cyber-purple mb-6 text-center",children:[t("i",{class:"fas fa-cloud-upload-alt mr-2"}),"画像アップロード"]}),t("div",{class:"border-2 border-dashed border-cyber-purple/30 rounded-xl p-6 sm:p-8 text-center hover:border-cyber-purple/50 transition-colors duration-300",children:t("div",{id:"dropZone",class:"cursor-pointer",children:[t("i",{class:"fas fa-image text-4xl sm:text-6xl text-cyber-purple/50 mb-4"}),t("p",{class:"text-base sm:text-lg text-gray-300 mb-2",children:[t("span",{class:"hidden sm:inline",children:"画像をドラッグ&ドロップまたは"}),"クリックしてアップロード"]}),t("p",{class:"text-xs sm:text-sm text-gray-400 mb-4",children:"PNG, JPG, JPEG対応（最大10MB）"}),t("div",{class:"flex flex-col sm:flex-row gap-2 sm:gap-4 justify-center items-center",children:[t("button",{type:"button",onclick:"document.getElementById('imageUpload').click()",class:"w-full sm:w-auto bg-cyber-purple/20 border border-cyber-purple/50 text-cyber-purple px-4 py-2 rounded-lg hover:bg-cyber-purple/30 transition-colors",children:[t("i",{class:"fas fa-folder-open mr-2"}),"ファイルを選択"]}),t("button",{type:"button",onclick:"document.getElementById('cameraUpload').click()",class:"w-full sm:w-auto bg-cyber-blue/20 border border-cyber-blue/50 text-cyber-blue px-4 py-2 rounded-lg hover:bg-cyber-blue/30 transition-colors sm:hidden",children:[t("i",{class:"fas fa-camera mr-2"}),"カメラで撮影"]})]}),t("input",{type:"file",id:"imageUpload",class:"hidden",accept:"image/png,image/jpeg,image/jpg,image/webp",capture:"environment"}),t("input",{type:"file",id:"cameraUpload",class:"hidden",accept:"image/*",capture:"environment"})]})}),t("div",{id:"imagePreview",class:"hidden mt-6",children:[t("img",{id:"previewImage",class:"max-w-xs h-auto max-h-64 rounded-lg border border-gray-600 mx-auto block"}),t("p",{id:"imageName",class:"text-sm text-gray-400 mt-2 text-center"})]})]})}),t("div",{id:"abUpload",class:"hidden mb-12",children:t("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/20 p-6",children:[t("h3",{class:"text-xl font-semibold text-cyber-blue mb-4 text-center",children:"🅰️ パターンA"}),t("div",{class:"border-2 border-dashed border-cyber-blue/30 rounded-xl p-4 sm:p-6 text-center hover:border-cyber-blue/50 transition-colors duration-300",children:t("div",{id:"dropZoneA",class:"cursor-pointer",children:[t("i",{class:"fas fa-image text-3xl sm:text-4xl text-cyber-blue/50 mb-3"}),t("p",{class:"text-sm sm:text-base text-gray-300 mb-2",children:"画像Aをアップロード"}),t("div",{class:"flex flex-col gap-2",children:[t("button",{type:"button",onclick:"document.getElementById('imageUploadA').click()",class:"w-full bg-cyber-blue/20 border border-cyber-blue/50 text-cyber-blue px-3 py-1.5 rounded text-sm hover:bg-cyber-blue/30 transition-colors",children:[t("i",{class:"fas fa-folder-open mr-1"}),"選択"]}),t("button",{type:"button",onclick:"document.getElementById('cameraUploadA').click()",class:"w-full bg-cyber-green/20 border border-cyber-green/50 text-cyber-green px-3 py-1.5 rounded text-sm hover:bg-cyber-green/30 transition-colors sm:hidden",children:[t("i",{class:"fas fa-camera mr-1"}),"撮影"]})]}),t("input",{type:"file",id:"imageUploadA",class:"hidden",accept:"image/png,image/jpeg,image/jpg,image/webp"}),t("input",{type:"file",id:"cameraUploadA",class:"hidden",accept:"image/*",capture:"environment"})]})}),t("div",{id:"imagePreviewA",class:"hidden mt-4",children:t("img",{id:"previewImageA",class:"max-w-full h-auto max-h-48 rounded-lg border border-gray-600 mx-auto block"})})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-pink/20 p-6",children:[t("h3",{class:"text-xl font-semibold text-cyber-pink mb-4 text-center",children:"🅱️ パターンB"}),t("div",{class:"border-2 border-dashed border-cyber-pink/30 rounded-xl p-4 sm:p-6 text-center hover:border-cyber-pink/50 transition-colors duration-300",children:t("div",{id:"dropZoneB",class:"cursor-pointer",children:[t("i",{class:"fas fa-image text-3xl sm:text-4xl text-cyber-pink/50 mb-3"}),t("p",{class:"text-sm sm:text-base text-gray-300 mb-2",children:"画像Bをアップロード"}),t("div",{class:"flex flex-col gap-2",children:[t("button",{type:"button",onclick:"document.getElementById('imageUploadB').click()",class:"w-full bg-cyber-pink/20 border border-cyber-pink/50 text-cyber-pink px-3 py-1.5 rounded text-sm hover:bg-cyber-pink/30 transition-colors",children:[t("i",{class:"fas fa-folder-open mr-1"}),"選択"]}),t("button",{type:"button",onclick:"document.getElementById('cameraUploadB').click()",class:"w-full bg-cyber-green/20 border border-cyber-green/50 text-cyber-green px-3 py-1.5 rounded text-sm hover:bg-cyber-green/30 transition-colors sm:hidden",children:[t("i",{class:"fas fa-camera mr-1"}),"撮影"]})]}),t("input",{type:"file",id:"imageUploadB",class:"hidden",accept:"image/png,image/jpeg,image/jpg,image/webp"}),t("input",{type:"file",id:"cameraUploadB",class:"hidden",accept:"image/*",capture:"environment"})]})}),t("div",{id:"imagePreviewB",class:"hidden mt-4",children:t("img",{id:"previewImageB",class:"max-w-full h-auto max-h-48 rounded-lg border border-gray-600 mx-auto block"})})]})]})}),t("div",{class:"text-center mb-12",children:t("button",{id:"analyzeButton",onclick:"startSingleAnalysis()",disabled:!0,class:"px-12 py-4 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-full text-white font-bold text-lg shadow-2xl hover:shadow-cyber-blue/50 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[t("span",{id:"analyzeButtonText",children:[t("i",{class:"fas fa-rocket mr-3"}),"AI分析開始"]}),t("span",{id:"analyzeSpinner",class:"hidden",children:[t("i",{class:"fas fa-spinner fa-spin mr-3"}),"AI分析中..."]})]})}),t("div",{id:"resultsSection",class:"hidden",children:[t("div",{id:"analysisResult"}),t("div",{id:"singleResults",class:"hidden",children:t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-green/20 p-8 mb-8 animate-slide-up",children:[t("h3",{class:"text-2xl font-semibold text-cyber-green mb-6 text-center",children:[t("i",{class:"fas fa-chart-line mr-2"}),"AI分析結果"]}),t("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t("div",{class:"space-y-4",children:[t("div",{class:"bg-gradient-to-br from-cyber-blue/20 to-cyber-purple/10 border border-cyber-blue/30 rounded-xl p-6 text-center",children:[t("div",{id:"totalScore",class:"text-5xl font-orbitron font-bold text-cyber-blue mb-2",children:"82"}),t("p",{class:"text-gray-300",children:"総合スコア"}),t("p",{id:"scoreLevel",class:"text-cyber-green text-sm",children:"優秀レベル"})]}),t("div",{id:"individualScores",class:"space-y-3"})]}),t("div",{class:"lg:col-span-2 space-y-6",children:[t("div",{class:"bg-navy-700/30 rounded-xl p-6",children:[t("h4",{class:"text-lg font-semibold text-cyber-blue mb-4",children:[t("i",{class:"fas fa-bullseye mr-2"}),"ターゲット適合度"]}),t("div",{class:"flex items-center mb-2",children:[t("span",{class:"text-2xl font-bold text-cyber-green",id:"targetMatch",children:"91%"}),t("span",{class:"ml-2 text-gray-400",children:"適合"})]}),t("p",{class:"text-gray-300 text-sm",children:"選択されたターゲット層に対する訴求力が非常に高く、適切なトーンとメッセージングが使用されています。"})]}),t("div",{class:"bg-navy-700/30 rounded-xl p-6",children:[t("h4",{class:"text-lg font-semibold text-cyber-green mb-4",children:[t("i",{class:"fas fa-check-circle mr-2"}),"強み・優秀なポイント"]}),t("ul",{id:"strengthsList",class:"space-y-2 text-sm text-gray-300"})]}),t("div",{class:"bg-navy-700/30 rounded-xl p-6",children:[t("h4",{class:"text-lg font-semibold text-cyber-orange mb-4",children:[t("i",{class:"fas fa-exclamation-triangle mr-2"}),"改善提案"]}),t("ul",{id:"improvementsList",class:"space-y-2 text-sm text-gray-300"})]}),t("div",{class:"bg-navy-700/30 rounded-xl p-6",children:[t("h4",{class:"text-lg font-semibold text-cyber-pink mb-4",children:[t("i",{class:"fas fa-chart-area mr-2"}),"予想パフォーマンス"]}),t("div",{id:"performanceMetrics",class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"})]})]})]})]})}),t("div",{id:"abResults",class:"hidden",children:t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-pink/20 p-8 mb-8 animate-slide-up",children:[t("h3",{class:"text-2xl font-semibold text-cyber-pink mb-6 text-center",children:[t("i",{class:"fas fa-trophy mr-2"}),"A/B比較分析結果"]}),t("div",{id:"winnerAnnouncement",class:"bg-gradient-to-r from-cyber-pink/20 to-cyber-orange/10 border border-cyber-pink/30 rounded-xl p-8 mb-8 text-center"}),t("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t("div",{class:"bg-gradient-to-br from-cyber-blue/20 to-navy-700/30 border border-cyber-blue/30 rounded-xl p-6",children:[t("h4",{class:"text-xl font-semibold text-cyber-blue mb-4 text-center",children:"🥇 パターンA (勝者)"}),t("div",{class:"text-center mb-4",children:[t("div",{class:"text-3xl font-orbitron font-bold text-cyber-green",children:"87"}),t("p",{class:"text-gray-300 text-sm",children:"総合スコア"})]}),t("div",{id:"patternAScores",class:"space-y-2"})]}),t("div",{class:"flex flex-col justify-center items-center",children:[t("div",{class:"text-4xl font-orbitron font-bold text-cyber-pink mb-4",children:"VS"}),t("div",{class:"text-center",children:[t("p",{class:"text-gray-400 text-sm",children:"スコア差"}),t("p",{class:"text-2xl font-bold text-cyber-green",children:"+12点"})]})]}),t("div",{class:"bg-gradient-to-br from-gray-500/20 to-navy-700/30 border border-gray-500/30 rounded-xl p-6",children:[t("h4",{class:"text-xl font-semibold text-gray-400 mb-4 text-center",children:"🥈 パターンB"}),t("div",{class:"text-center mb-4",children:[t("div",{class:"text-3xl font-orbitron font-bold text-cyber-orange",children:"75"}),t("p",{class:"text-gray-300 text-sm",children:"総合スコア"})]}),t("div",{id:"patternBScores",class:"space-y-2"})]})]}),t("div",{class:"mt-8 bg-navy-700/30 rounded-xl p-6",children:[t("h4",{class:"text-lg font-semibold text-cyber-blue mb-4",children:[t("i",{class:"fas fa-clipboard-list mr-2"}),"詳細比較レポート"]}),t("div",{id:"comparisonReport",class:"space-y-4 text-sm text-gray-300"})]}),t("div",{class:"mt-6 bg-gradient-to-r from-cyber-green/20 to-green-600/10 border border-cyber-green/30 rounded-xl p-6",children:[t("h4",{class:"text-lg font-semibold text-cyber-green mb-4",children:[t("i",{class:"fas fa-bullseye mr-2"}),"実装推奨アクション"]}),t("div",{id:"actionRecommendations",class:"space-y-2 text-sm text-white"})]})]})})]})]}),t("script",{dangerouslySetInnerHTML:{__html:`
          document.addEventListener('DOMContentLoaded', function() {
            let uploadedImage = null;
            let uploadedImageA = null;
            let uploadedImageB = null;
            let isAnalyzing = false;
            
            // DOM Elements
            const abModeCheckbox = document.getElementById('abMode');
            const singleUpload = document.getElementById('singleUpload');
            const abUpload = document.getElementById('abUpload');
            const dropZone = document.getElementById('dropZone');
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            const imageName = document.getElementById('imageName');
            const analyzeButton = document.getElementById('analyzeButton');
            const analyzeButtonText = document.getElementById('analyzeButtonText');
            const analyzeSpinner = document.getElementById('analyzeSpinner');
            const resultsSection = document.getElementById('resultsSection');
            const singleResults = document.getElementById('singleResults');
            const abResults = document.getElementById('abResults');
            
            // A/B mode toggle
            abModeCheckbox.addEventListener('change', function() {
              if (this.checked) {
                singleUpload.classList.add('hidden');
                abUpload.classList.remove('hidden');
                updateAnalyzeButton();
              } else {
                singleUpload.classList.remove('hidden');
                abUpload.classList.add('hidden');
                updateAnalyzeButton();
              }
            });
            
            // Single image upload
            dropZone.addEventListener('click', () => {
              imageUpload.click();
            });
            dropZone.addEventListener('dragover', (e) => {
              e.preventDefault();
              e.stopPropagation();
              dropZone.classList.add('border-cyber-purple');
            });
            dropZone.addEventListener('dragleave', (e) => {
              e.preventDefault();
              e.stopPropagation();
              dropZone.classList.remove('border-cyber-purple');
            });
            dropZone.addEventListener('drop', (e) => {
              e.preventDefault();
              e.stopPropagation();
              dropZone.classList.remove('border-cyber-purple');
              const files = e.dataTransfer.files;
              if (files.length > 0) {
                handleImageUpload(files[0]);
              }
            });
            
            imageUpload.addEventListener('change', (e) => {
              if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
              }
            });
            
            function handleImageUpload(file) {
              if (!file.type.startsWith('image/')) {
                alert('画像ファイルを選択してください。');
                return;
              }
              
              if (file.size > 10 * 1024 * 1024) {
                alert('ファイルサイズは10MB以下にしてください。');
                return;
              }
              
              uploadedImage = file;
              const reader = new FileReader();
              reader.onload = (e) => {
                previewImage.src = e.target.result;
                imageName.textContent = file.name;
                imagePreview.classList.remove('hidden');
                updateAnalyzeButton();
              };
              reader.readAsDataURL(file);
            }
            
            // A/B upload handlers
            setupABUpload('A');
            setupABUpload('B');
            
            function setupABUpload(pattern) {
              const dropZone = document.getElementById('dropZone' + pattern);
              const imageUpload = document.getElementById('imageUpload' + pattern);
              const imagePreview = document.getElementById('imagePreview' + pattern);
              const previewImage = document.getElementById('previewImage' + pattern);
              
              dropZone.addEventListener('click', () => {
                imageUpload.click();
              });
              dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.add('border-cyber-' + (pattern === 'A' ? 'blue' : 'pink'));
              });
              dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('border-cyber-' + (pattern === 'A' ? 'blue' : 'pink'));
              });
              dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('border-cyber-' + (pattern === 'A' ? 'blue' : 'pink'));
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                  handleABImageUpload(files[0], pattern);
                }
              });
              
              imageUpload.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                  handleABImageUpload(e.target.files[0], pattern);
                }
              });
            }
            
            function handleABImageUpload(file, pattern) {
              if (!file.type.startsWith('image/')) {
                alert('画像ファイルを選択してください。');
                return;
              }
              
              if (file.size > 10 * 1024 * 1024) {
                alert('ファイルサイズは10MB以下にしてください。');
                return;
              }
              
              if (pattern === 'A') {
                uploadedImageA = file;
              } else {
                uploadedImageB = file;
              }
              
              const reader = new FileReader();
              reader.onload = (e) => {
                document.getElementById('previewImage' + pattern).src = e.target.result;
                document.getElementById('imagePreview' + pattern).classList.remove('hidden');
                updateAnalyzeButton();
              };
              reader.readAsDataURL(file);
            }
            
            function updateAnalyzeButton() {
              if (isAnalyzing) return;
              
              if (abModeCheckbox.checked) {
                analyzeButton.disabled = !uploadedImageA || !uploadedImageB;
              } else {
                analyzeButton.disabled = !uploadedImage;
              }
            }
            
            // Analysis button handler
            analyzeButton.addEventListener('click', async function() {
              if (isAnalyzing) return;
              
              isAnalyzing = true;
              analyzeButton.disabled = true;
              analyzeButtonText.classList.add('hidden');
              analyzeSpinner.classList.remove('hidden');
              
              try {
                if (abModeCheckbox.checked) {
                  await performABAnalysis();
                } else {
                  await performSingleAnalysis();
                }
              } catch (error) {
                console.error('Analysis error:', error);
                alert('分析中にエラーが発生しました。もう一度お試しください。');
              } finally {
                isAnalyzing = false;
                analyzeButton.disabled = false;
                analyzeButtonText.classList.remove('hidden');
                analyzeSpinner.classList.add('hidden');
                updateAnalyzeButton();
              }
            });
            
            async function performSingleAnalysis() {
              const formData = new FormData();
              formData.append('image', uploadedImage);
              
              const response = await fetch('/api/analysis/single', {
                method: 'POST',
                body: formData
              });
              
              const data = await response.json();
              
              if (data.success) {
                displaySingleResults(data.result);
              } else {
                throw new Error(data.message || '分析に失敗しました');
              }
            }
            
            async function performABAnalysis() {
              const formData = new FormData();
              formData.append('imageA', uploadedImageA);
              formData.append('imageB', uploadedImageB);
              
              const response = await fetch('/api/analysis/compare', {
                method: 'POST',
                body: formData
              });
              
              const data = await response.json();
              
              if (data.success) {
                displayABResults(data.result);
              } else {
                throw new Error(data.message || 'A/B比較分析に失敗しました');
              }
            }
            
            function displaySingleResults(result) {
              resultsSection.classList.remove('hidden');
              singleResults.classList.remove('hidden');
              abResults.classList.add('hidden');
              
              // Update total score
              document.getElementById('totalScore').textContent = result.totalScore;
              document.getElementById('scoreLevel').textContent = result.level;
              
              // Update individual scores
              const scoresContainer = document.getElementById('individualScores');
              scoresContainer.innerHTML = '';
              
              for (const [key, scoreData] of Object.entries(result.scores)) {
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'bg-navy-700/50 border border-gray-600 rounded-lg p-3 text-center';
                scoreDiv.innerHTML = \`
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-xs text-gray-400">\${scoreData.label}</span>
                    <span class="text-lg font-bold" style="color: \${scoreData.color}">\${scoreData.score}</span>
                  </div>
                  <div class="w-full bg-gray-700 rounded-full h-2">
                    <div class="h-2 rounded-full" style="width: \${scoreData.score}%; background-color: \${scoreData.color}"></div>
                  </div>
                \`;
                scoresContainer.appendChild(scoreDiv);
              }
              
              // Update target match
              document.getElementById('targetMatch').textContent = result.analysis.targetMatch + '%';
              
              // Update strengths
              const strengthsList = document.getElementById('strengthsList');
              strengthsList.innerHTML = '';
              result.analysis.strengths.forEach(strength => {
                const li = document.createElement('li');
                li.innerHTML = '<i class="fas fa-check text-cyber-green mr-2"></i>' + strength;
                strengthsList.appendChild(li);
              });
              
              // Update improvements
              const improvementsList = document.getElementById('improvementsList');
              improvementsList.innerHTML = '';
              result.analysis.improvements.forEach(improvement => {
                const li = document.createElement('li');
                li.innerHTML = '<i class="fas fa-arrow-up text-cyber-orange mr-2"></i>' + improvement;
                improvementsList.appendChild(li);
              });
              
              // Update performance metrics
              const performanceContainer = document.getElementById('performanceMetrics');
              performanceContainer.innerHTML = \`
                <div class="bg-gradient-to-r from-green-600/20 to-green-400/10 border border-green-400/30 rounded-lg p-4 text-center">
                  <div class="text-lg font-bold text-green-400">\${result.analysis.performance.clickRate.improved}%</div>
                  <div class="text-xs text-gray-400">クリック率（+\${result.analysis.performance.clickRate.change}%）</div>
                </div>
                <div class="bg-gradient-to-r from-blue-600/20 to-blue-400/10 border border-blue-400/30 rounded-lg p-4 text-center">
                  <div class="text-lg font-bold text-blue-400">\${result.analysis.performance.conversionRate.improved}%</div>
                  <div class="text-xs text-gray-400">コンバージョン率（+\${result.analysis.performance.conversionRate.change}%）</div>
                </div>
                <div class="bg-gradient-to-r from-purple-600/20 to-purple-400/10 border border-purple-400/30 rounded-lg p-4 text-center">
                  <div class="text-lg font-bold text-purple-400">+\${result.analysis.performance.brandAwareness.change}%</div>
                  <div class="text-xs text-gray-400">ブランド認知向上</div>
                </div>
              \`;
              
              // Show note if using demo data
              if (result.note) {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'mt-4 p-3 bg-yellow-600/20 border border-yellow-400/30 rounded-lg text-center';
                noteDiv.innerHTML = '<i class="fas fa-info-circle mr-2 text-yellow-400"></i>' + result.note;
                performanceContainer.parentElement.appendChild(noteDiv);
              }
              
              // Scroll to results
              resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            function displayABResults(result) {
              resultsSection.classList.remove('hidden');
              abResults.classList.remove('hidden');
              singleResults.classList.add('hidden');
              
              // Show note if using demo data
              if (result.note) {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'mb-6 p-3 bg-yellow-600/20 border border-yellow-400/30 rounded-lg text-center';
                noteDiv.innerHTML = '<i class="fas fa-info-circle mr-2 text-yellow-400"></i>' + result.note;
                document.querySelector('#abResults .bg-navy-800\\/50').prepend(noteDiv);
              }
              
              // Scroll to results
              resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
          });
        `}}),t("script",{src:"/static/js/analysis.js"})]}),pa=()=>t("div",{class:"min-h-screen pt-20 pb-20",children:[t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[t("div",{class:"text-center mb-12 animate-slide-up",children:[t("h1",{class:"text-4xl md:text-5xl font-orbitron font-bold mb-4",children:t("span",{class:"bg-gradient-to-r from-cyber-pink to-cyber-orange bg-clip-text text-transparent",children:"AIコピー生成"})}),t("p",{class:"text-xl text-gray-300 max-w-3xl mx-auto",children:"画像から効果的な広告コピーを自動生成。業界特化型AIが最適なメッセージを提案"})]}),t("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-pink/20 p-6",children:[t("h3",{class:"text-xl font-semibold text-cyber-pink mb-6",children:[t("i",{class:"fas fa-bullseye mr-2"}),"ターゲット設定"]}),t("div",{class:"space-y-4",children:[t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"業界"}),t("select",{id:"copyIndustry",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-pink transition-colors",children:[t("option",{value:"美容",children:"美容"}),t("option",{value:"飲食",children:"飲食"}),t("option",{value:"不動産",children:"不動産"}),t("option",{value:"子ども写真館",children:"子ども写真館"}),t("option",{value:"ファッション",children:"ファッション"}),t("option",{value:"教育",children:"教育"}),t("option",{value:"その他",children:"その他"})]})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"媒体"}),t("select",{id:"copyPlatform",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-pink transition-colors",children:[t("option",{value:"Instagram",children:"Instagram"}),t("option",{value:"Facebook",children:"Facebook"}),t("option",{value:"GDN",children:"GDN"}),t("option",{value:"YDN",children:"YDN"}),t("option",{value:"Twitter",children:"Twitter"}),t("option",{value:"LINE",children:"LINE広告"})]})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"ターゲット年代"}),t("select",{id:"copyAgeGroup",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-pink transition-colors",children:[t("option",{value:"10代",children:"10代"}),t("option",{value:"20代",children:"20代"}),t("option",{value:"30代",children:"30代"}),t("option",{value:"40代",children:"40代"}),t("option",{value:"50代",children:"50代"}),t("option",{value:"60代以上",children:"60代以上"})]})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"トーン"}),t("select",{id:"copyTone",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-pink transition-colors",children:[t("option",{value:"フレンドリー",children:"フレンドリー"}),t("option",{value:"プロフェッショナル",children:"プロフェッショナル"}),t("option",{value:"カジュアル",children:"カジュアル"}),t("option",{value:"エレガント",children:"エレガント"}),t("option",{value:"エネルギッシュ",children:"エネルギッシュ"}),t("option",{value:"信頼感",children:"信頼感"})]})]})]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-orange/20 p-6",children:[t("h3",{class:"text-xl font-semibold text-cyber-orange mb-6",children:[t("i",{class:"fas fa-cog mr-2"}),"生成オプション"]}),t("div",{class:"space-y-4",children:[t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"コピータイプ"}),t("div",{class:"space-y-2",children:[t("label",{class:"flex items-center",children:[t("input",{type:"checkbox",checked:!0,class:"w-4 h-4 text-cyber-orange bg-navy-700 border-gray-600 rounded focus:ring-cyber-orange/20 focus:ring-2"}),t("span",{class:"ml-2 text-sm text-gray-300",children:"メインコピー"})]}),t("label",{class:"flex items-center",children:[t("input",{type:"checkbox",checked:!0,class:"w-4 h-4 text-cyber-orange bg-navy-700 border-gray-600 rounded focus:ring-cyber-orange/20 focus:ring-2"}),t("span",{class:"ml-2 text-sm text-gray-300",children:"キャッチコピー"})]}),t("label",{class:"flex items-center",children:[t("input",{type:"checkbox",checked:!0,class:"w-4 h-4 text-cyber-orange bg-navy-700 border-gray-600 rounded focus:ring-cyber-orange/20 focus:ring-2"}),t("span",{class:"ml-2 text-sm text-gray-300",children:"CTAコピー"})]}),t("label",{class:"flex items-center",children:[t("input",{type:"checkbox",class:"w-4 h-4 text-cyber-orange bg-navy-700 border-gray-600 rounded focus:ring-cyber-orange/20 focus:ring-2"}),t("span",{class:"ml-2 text-sm text-gray-300",children:"サブコピー"})]})]})]}),t("div",{children:[t("label",{class:"block text-sm font-medium text-gray-300 mb-2",children:"生成数"}),t("select",{id:"copyCount",class:"w-full px-4 py-2 bg-navy-700/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyber-orange transition-colors",children:[t("option",{value:"3",children:"3パターン"}),t("option",{value:"5",selected:!0,children:"5パターン"}),t("option",{value:"7",children:"7パターン"}),t("option",{value:"10",children:"10パターン"})]})]}),t("div",{children:t("label",{class:"flex items-center",children:[t("input",{type:"checkbox",id:"includeEmoji",class:"w-4 h-4 text-cyber-orange bg-navy-700 border-gray-600 rounded focus:ring-cyber-orange/20 focus:ring-2"}),t("span",{class:"ml-2 text-sm text-gray-300",children:"絵文字を含める"})]})}),t("div",{children:t("label",{class:"flex items-center",children:[t("input",{type:"checkbox",id:"urgencyElement",class:"w-4 h-4 text-cyber-orange bg-navy-700 border-gray-600 rounded focus:ring-cyber-orange/20 focus:ring-2"}),t("span",{class:"ml-2 text-sm text-gray-300",children:"緊急性要素を含める"})]})})]}),t("div",{class:"mt-6 p-4 bg-cyber-orange/10 rounded-lg border border-cyber-orange/20",children:[t("h4",{class:"text-sm font-semibold text-cyber-orange mb-2",children:[t("i",{class:"fas fa-lightbulb mr-2"}),"AIのポイント"]}),t("ul",{class:"text-xs text-gray-300 space-y-1",children:[t("li",{children:"• 業界特性を考慮した最適化"}),t("li",{children:"• ターゲット層に響く言葉選び"}),t("li",{children:"• 媒体の文字制限に配慮"}),t("li",{children:"• 効果予測スコア付き"})]})]})]})]}),t("div",{class:"mb-12",children:t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-purple/20 p-8",children:[t("h3",{class:"text-2xl font-semibold text-cyber-purple mb-6 text-center",children:[t("i",{class:"fas fa-cloud-upload-alt mr-2"}),"バナー画像アップロード"]}),t("div",{class:"border-2 border-dashed border-cyber-purple/30 rounded-xl p-6 sm:p-8 text-center hover:border-cyber-purple/50 transition-colors duration-300",children:t("div",{id:"copyDropZone",class:"cursor-pointer",children:[t("i",{class:"fas fa-image text-4xl sm:text-6xl text-cyber-purple/50 mb-4"}),t("p",{class:"text-base sm:text-lg text-gray-300 mb-2",children:[t("span",{class:"hidden sm:inline",children:"コピー生成用の"}),"画像をアップロード"]}),t("p",{class:"text-xs sm:text-sm text-gray-400 mb-4",children:"PNG, JPG, JPEG対応（最大10MB）"}),t("div",{class:"flex flex-col sm:flex-row gap-2 sm:gap-4 justify-center items-center",children:[t("button",{type:"button",onclick:"document.getElementById('copyImageUpload').click()",class:"w-full sm:w-auto bg-cyber-purple/20 border border-cyber-purple/50 text-cyber-purple px-4 py-2 rounded-lg hover:bg-cyber-purple/30 transition-colors",children:[t("i",{class:"fas fa-folder-open mr-2"}),"ファイルを選択"]}),t("button",{type:"button",onclick:"document.getElementById('copyCameraUpload').click()",class:"w-full sm:w-auto bg-cyber-blue/20 border border-cyber-blue/50 text-cyber-blue px-4 py-2 rounded-lg hover:bg-cyber-blue/30 transition-colors sm:hidden",children:[t("i",{class:"fas fa-camera mr-2"}),"カメラで撮影"]})]}),t("input",{type:"file",id:"copyImageUpload",class:"hidden",accept:"image/png,image/jpeg,image/jpg,image/webp"}),t("input",{type:"file",id:"copyCameraUpload",class:"hidden",accept:"image/*",capture:"environment"})]})}),t("div",{id:"copyImagePreview",class:"hidden mt-6",children:[t("img",{id:"copyPreviewImage",class:"max-w-full h-auto rounded-lg border border-gray-600 mx-auto"}),t("p",{id:"copyImageName",class:"text-sm text-gray-400 mt-2 text-center"})]})]})}),t("div",{class:"text-center mb-12",children:t("button",{id:"generateButton",disabled:!0,class:"px-12 py-4 bg-gradient-to-r from-cyber-pink to-cyber-orange rounded-full text-white font-bold text-lg shadow-2xl hover:shadow-cyber-pink/50 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[t("span",{id:"generateButtonText",children:[t("i",{class:"fas fa-magic mr-3"}),"AIコピー生成開始"]}),t("span",{id:"generateSpinner",class:"hidden",children:[t("i",{class:"fas fa-spinner fa-spin mr-3"}),"生成中..."]})]})}),t("div",{id:"copyResultsSection",class:"hidden",children:t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-green/20 p-8 animate-slide-up",children:[t("h3",{class:"text-2xl font-semibold text-cyber-green mb-6 text-center",children:[t("i",{class:"fas fa-magic mr-2"}),"生成結果"]}),t("div",{class:"mb-8 p-6 bg-navy-700/30 rounded-xl",children:[t("h4",{class:"text-lg font-semibold text-cyber-blue mb-4",children:[t("i",{class:"fas fa-chart-bar mr-2"}),"全体分析"]}),t("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t("div",{class:"text-center",children:[t("div",{class:"text-2xl font-bold text-cyber-green",id:"overallScore",children:"88"}),t("p",{class:"text-gray-400 text-sm",children:"総合スコア"})]}),t("div",{class:"text-center",children:[t("div",{class:"text-2xl font-bold text-cyber-blue",id:"industryMatch",children:"95%"}),t("p",{class:"text-gray-400 text-sm",children:"業界適合度"})]}),t("div",{class:"text-center",children:[t("div",{class:"text-lg font-semibold text-cyber-pink",id:"targetAudience",children:"美容意識の高い20-40代女性"}),t("p",{class:"text-gray-400 text-sm",children:"推定ターゲット"})]})]})]}),t("div",{id:"generatedCopies",class:"space-y-6"}),t("div",{class:"mt-8 p-6 bg-gradient-to-r from-cyber-green/20 to-green-600/10 border border-cyber-green/30 rounded-xl",children:[t("h4",{class:"text-lg font-semibold text-cyber-green mb-4",children:[t("i",{class:"fas fa-bullseye mr-2"}),"実装推奨事項"]}),t("div",{id:"copyRecommendations",class:"space-y-2 text-sm text-white"})]}),t("div",{class:"mt-6 text-center",children:t("button",{id:"copyAllButton",class:"px-8 py-3 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-full text-white font-semibold hover:from-cyber-purple hover:to-cyber-pink transition-all duration-300 transform hover:scale-105",children:[t("i",{class:"fas fa-copy mr-2"}),"全てのコピーをクリップボードにコピー"]})})]})}),t("div",{class:"mt-16 bg-navy-800/30 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-8",children:[t("h3",{class:"text-2xl font-semibold text-white mb-6 text-center",children:[t("i",{class:"fas fa-lightbulb mr-2 text-cyber-blue"}),"生成例プレビュー"]}),t("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t("div",{class:"bg-navy-700/50 rounded-xl p-4 border border-cyber-blue/20",children:[t("div",{class:"flex items-center justify-between mb-3",children:[t("span",{class:"text-xs font-semibold text-cyber-blue bg-cyber-blue/20 px-2 py-1 rounded",children:"メインコピー"}),t("span",{class:"text-xs text-cyber-green font-semibold",children:"92%"})]}),t("p",{class:"text-white text-sm mb-2",children:'"美肌への近道、ここにあり。今すぐ体験してください。"'}),t("p",{class:"text-gray-400 text-xs",children:"緊急性と具体的なベネフィットを組み合わせた効果的なコピー"})]}),t("div",{class:"bg-navy-700/50 rounded-xl p-4 border border-cyber-green/20",children:[t("div",{class:"flex items-center justify-between mb-3",children:[t("span",{class:"text-xs font-semibold text-cyber-green bg-cyber-green/20 px-2 py-1 rounded",children:"キャッチコピー"}),t("span",{class:"text-xs text-cyber-green font-semibold",children:"89%"})]}),t("p",{class:"text-white text-sm mb-2",children:'"3日で実感！輝く美肌を手に入れる秘密"'}),t("p",{class:"text-gray-400 text-xs",children:"数字による具体性と期待感を高める表現が効果的"})]}),t("div",{class:"bg-navy-700/50 rounded-xl p-4 border border-cyber-pink/20",children:[t("div",{class:"flex items-center justify-between mb-3",children:[t("span",{class:"text-xs font-semibold text-cyber-pink bg-cyber-pink/20 px-2 py-1 rounded",children:"CTAコピー"}),t("span",{class:"text-xs text-cyber-green font-semibold",children:"87%"})]}),t("p",{class:"text-white text-sm mb-2",children:'"限定価格で今すぐ始める"'}),t("p",{class:"text-gray-400 text-xs",children:"限定性と行動喚起を組み合わせた強力なCTA"})]}),t("div",{class:"bg-navy-700/50 rounded-xl p-4 border border-cyber-orange/20",children:[t("div",{class:"flex items-center justify-between mb-3",children:[t("span",{class:"text-xs font-semibold text-cyber-orange bg-cyber-orange/20 px-2 py-1 rounded",children:"サブコピー"}),t("span",{class:"text-xs text-cyber-green font-semibold",children:"85%"})]}),t("p",{class:"text-white text-sm mb-2",children:'"94%のユーザーが満足した美容メソッド"'}),t("p",{class:"text-gray-400 text-xs",children:"社会的証明による信頼性向上"})]})]}),t("div",{class:"mt-6 text-center",children:t("p",{class:"text-gray-400 text-sm",children:[t("i",{class:"fas fa-info-circle mr-2 text-cyber-blue"}),"上記は生成例です。実際の画像をアップロードして、あなたのブランドに最適化されたコピーを生成してください。"]})})]})]}),t("script",{dangerouslySetInnerHTML:{__html:`
          document.addEventListener('DOMContentLoaded', function() {
            let uploadedImage = null;
            let isGenerating = false;
            
            // DOM Elements
            const dropZone = document.getElementById('copyDropZone');
            const imageUpload = document.getElementById('copyImageUpload');
            const imagePreview = document.getElementById('copyImagePreview');
            const previewImage = document.getElementById('copyPreviewImage');
            const generateButton = document.getElementById('generateButton');
            const generateButtonText = document.getElementById('generateButtonText');
            const generateSpinner = document.getElementById('generateSpinner');
            const resultsSection = document.getElementById('copyResultsSection');
            
            // Image upload handlers
            if (dropZone && imageUpload) {
              dropZone.addEventListener('click', () => {
                imageUpload.click();
              });
              dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.add('border-cyber-orange');
              });
              dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('border-cyber-orange');
              });
              dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('border-cyber-orange');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                  handleImageUpload(files[0]);
                }
              });
              
              imageUpload.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                  handleImageUpload(e.target.files[0]);
                }
              });
            }
            
            function handleImageUpload(file) {
              if (!file.type.startsWith('image/')) {
                alert('画像ファイルを選択してください。');
                return;
              }
              
              if (file.size > 10 * 1024 * 1024) {
                alert('ファイルサイズは10MB以下にしてください。');
                return;
              }
              
              uploadedImage = file;
              const reader = new FileReader();
              reader.onload = (e) => {
                if (previewImage && imagePreview) {
                  previewImage.src = e.target.result;
                  imagePreview.classList.remove('hidden');
                  updateGenerateButton();
                }
              };
              reader.readAsDataURL(file);
            }
            
            function updateGenerateButton() {
              if (generateButton && !isGenerating) {
                generateButton.disabled = !uploadedImage;
              }
            }
            
            // Generate button handler
            if (generateButton) {
              generateButton.addEventListener('click', async function() {
                if (isGenerating || !uploadedImage) return;
                
                isGenerating = true;
                generateButton.disabled = true;
                if (generateButtonText) generateButtonText.classList.add('hidden');
                if (generateSpinner) generateSpinner.classList.remove('hidden');
                
                try {
                  await performCopyGeneration();
                } catch (error) {
                  console.error('Copy generation error:', error);
                  alert('コピー生成中にエラーが発生しました。もう一度お試しください。');
                } finally {
                  isGenerating = false;
                  generateButton.disabled = false;
                  if (generateButtonText) generateButtonText.classList.remove('hidden');
                  if (generateSpinner) generateSpinner.classList.add('hidden');
                  updateGenerateButton();
                }
              });
            }
            
            async function performCopyGeneration() {
              const formData = new FormData();
              formData.append('image', uploadedImage);
              
              const response = await fetch('/api/copy-generation', {
                method: 'POST',
                body: formData
              });
              
              const data = await response.json();
              
              if (data.success) {
                displayCopyResults(data.result);
              } else {
                throw new Error(data.message || 'コピー生成に失敗しました');
              }
            }
            
            function displayCopyResults(result) {
              if (resultsSection) {
                resultsSection.classList.remove('hidden');
                
                // Clear existing results
                const existingResults = resultsSection.querySelector('.copy-results-container');
                if (existingResults) {
                  existingResults.remove();
                }
                
                // Create results container
                const resultsContainer = document.createElement('div');
                resultsContainer.className = 'copy-results-container bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-orange/20 p-8 mb-8 animate-slide-up';
                
                resultsContainer.innerHTML = \`
                  <h3 class="text-2xl font-semibold text-cyber-orange mb-6 text-center">
                    <i class="fas fa-magic mr-2"></i>生成されたコピー
                  </h3>
                  
                  \${result.note ? \`
                    <div class="mb-6 p-3 bg-yellow-600/20 border border-yellow-400/30 rounded-lg text-center">
                      <i class="fas fa-info-circle mr-2 text-yellow-400"></i>\${result.note}
                    </div>
                  \` : ''}
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    \${result.copies.map(copy => \`
                      <div class="bg-navy-700/50 border border-gray-600/50 rounded-xl p-6 hover:border-cyber-orange/30 transition-colors">
                        <div class="flex justify-between items-start mb-4">
                          <h4 class="text-lg font-semibold text-cyber-orange">\${copy.type}</h4>
                          <span class="bg-gradient-to-r from-cyber-green/20 to-green-400/10 border border-cyber-green/30 px-3 py-1 rounded-full text-xs font-bold text-cyber-green">
                            効果度: \${copy.effectiveness}%
                          </span>
                        </div>
                        <p class="text-white text-lg mb-4 leading-relaxed">\${copy.text}</p>
                        <p class="text-gray-400 text-sm">\${copy.reasoning}</p>
                        <button class="mt-3 px-4 py-2 bg-cyber-orange/20 border border-cyber-orange/30 rounded-lg text-cyber-orange text-sm hover:bg-cyber-orange/30 transition-colors" onclick="navigator.clipboard.writeText('\${copy.text}'); this.textContent='コピー済み!'; setTimeout(() => this.textContent='コピー', 2000)">
                          <i class="fas fa-copy mr-2"></i>コピー
                        </button>
                      </div>
                    \`).join('')}
                  </div>
                  
                  <div class="bg-navy-700/30 rounded-xl p-6">
                    <h4 class="text-lg font-semibold text-cyber-green mb-4">
                      <i class="fas fa-chart-line mr-2"></i>分析サマリー
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                      <div class="text-center">
                        <div class="text-2xl font-bold text-cyber-green">\${result.analysis.overallScore}</div>
                        <p class="text-gray-400 text-sm">総合スコア</p>
                      </div>
                      <div class="text-center">
                        <div class="text-2xl font-bold text-cyber-blue">\${result.analysis.industryMatch}%</div>
                        <p class="text-gray-400 text-sm">業界適合度</p>
                      </div>
                      <div class="text-center">
                        <div class="text-lg font-semibold text-cyber-pink">\${result.analysis.targetAudience}</div>
                        <p class="text-gray-400 text-sm">想定ターゲット</p>
                      </div>
                    </div>
                    
                    <div class="mt-6">
                      <h5 class="text-md font-semibold text-cyber-orange mb-3">実装推奨事項</h5>
                      <ul class="space-y-2">
                        \${result.analysis.recommendations.map(rec => \`
                          <li class="text-gray-300 text-sm">
                            <i class="fas fa-check-circle text-cyber-green mr-2"></i>\${rec}
                          </li>
                        \`).join('')}
                      </ul>
                    </div>
                  </div>
                \`;
                
                resultsSection.appendChild(resultsContainer);
                
                // Scroll to results
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
              }
            }
          });
        `}})]}),ba=()=>t("div",{class:"min-h-screen bg-gradient-to-br from-navy-900 via-navy-800 to-navy-900",children:[t("header",{class:"bg-navy-800/50 backdrop-blur-lg border-b border-cyber-blue/20",children:t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t("div",{class:"flex justify-between items-center py-6",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-12 h-12 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-xl flex items-center justify-center mr-4",children:t("i",{class:"fas fa-chart-line text-white text-xl"})}),t("div",{children:[t("h1",{class:"text-2xl font-orbitron font-bold text-white",children:"バナスコAI"}),t("p",{class:"text-cyber-blue text-sm",children:"運営管理ダッシュボード"})]})]}),t("div",{class:"flex items-center space-x-4",children:[t("div",{class:"text-right",children:[t("p",{class:"text-white font-medium",children:"管理者"}),t("p",{class:"text-gray-400 text-sm",children:"admin@banasuko.com"})]}),t("button",{class:"bg-red-500/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-500/30 transition-colors",children:[t("i",{class:"fas fa-sign-out-alt mr-2"}),"ログアウト"]})]})]})})}),t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/20 p-6",children:t("div",{class:"flex items-center justify-between",children:[t("div",{children:[t("p",{class:"text-gray-400 text-sm font-medium",children:"総ユーザー数"}),t("p",{class:"text-3xl font-bold text-white mt-2",id:"totalUsers",children:"-"}),t("p",{class:"text-cyber-green text-sm mt-1",children:[t("i",{class:"fas fa-arrow-up mr-1"}),t("span",{id:"userGrowth",children:"-"})," 今月"]})]}),t("div",{class:"w-12 h-12 bg-cyber-blue/20 rounded-xl flex items-center justify-center",children:t("i",{class:"fas fa-users text-cyber-blue text-xl"})})]})}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-green/20 p-6",children:t("div",{class:"flex items-center justify-between",children:[t("div",{children:[t("p",{class:"text-gray-400 text-sm font-medium",children:"アクティブユーザー"}),t("p",{class:"text-3xl font-bold text-white mt-2",id:"activeUsers",children:"-"}),t("p",{class:"text-cyber-green text-sm mt-1",children:[t("span",{id:"activeRate",children:"-"}),"% アクティブ率"]})]}),t("div",{class:"w-12 h-12 bg-cyber-green/20 rounded-xl flex items-center justify-center",children:t("i",{class:"fas fa-user-check text-cyber-green text-xl"})})]})}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-pink/20 p-6",children:t("div",{class:"flex items-center justify-between",children:[t("div",{children:[t("p",{class:"text-gray-400 text-sm font-medium",children:"月間収益"}),t("p",{class:"text-3xl font-bold text-white mt-2",children:["¥",t("span",{id:"monthlyRevenue",children:"-"})]}),t("p",{class:"text-cyber-pink text-sm mt-1",children:[t("i",{class:"fas fa-arrow-up mr-1"}),t("span",{id:"revenueGrowth",children:"-"}),"% 前月比"]})]}),t("div",{class:"w-12 h-12 bg-cyber-pink/20 rounded-xl flex items-center justify-center",children:t("i",{class:"fas fa-yen-sign text-cyber-pink text-xl"})})]})}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-orange/20 p-6",children:t("div",{class:"flex items-center justify-between",children:[t("div",{children:[t("p",{class:"text-gray-400 text-sm font-medium",children:"月間API使用数"}),t("p",{class:"text-3xl font-bold text-white mt-2",id:"monthlyApiUsage",children:"-"}),t("p",{class:"text-cyber-orange text-sm mt-1",children:[t("span",{id:"apiUsageGrowth",children:"-"})," 前月比"]})]}),t("div",{class:"w-12 h-12 bg-cyber-orange/20 rounded-xl flex items-center justify-center",children:t("i",{class:"fas fa-chart-bar text-cyber-orange text-xl"})})]})})]}),t("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t("div",{class:"lg:col-span-2",children:t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("div",{class:"flex items-center justify-between mb-6",children:[t("h2",{class:"text-xl font-semibold text-white",children:[t("i",{class:"fas fa-users-cog mr-2 text-cyber-blue"}),"ユーザー管理"]}),t("div",{class:"flex space-x-2",children:[t("select",{class:"bg-navy-700 text-white px-3 py-2 rounded-lg border border-gray-600 text-sm",children:[t("option",{children:"全プラン"}),t("option",{children:"フリー"}),t("option",{children:"ベーシック"}),t("option",{children:"プレミアム"})]}),t("button",{class:"bg-cyber-blue text-white px-4 py-2 rounded-lg hover:bg-cyber-purple transition-colors text-sm",children:[t("i",{class:"fas fa-download mr-2"}),"エクスポート"]})]})]}),t("div",{class:"overflow-x-auto",children:t("table",{class:"w-full",children:[t("thead",{children:t("tr",{class:"border-b border-gray-700",children:[t("th",{class:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"ユーザー"}),t("th",{class:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"プラン"}),t("th",{class:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"使用数"}),t("th",{class:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"登録日"}),t("th",{class:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"操作"})]})}),t("tbody",{id:"userTableBody",children:t("tr",{class:"border-b border-gray-800 hover:bg-navy-700/30",children:[t("td",{class:"py-4 px-4",children:t("div",{class:"flex items-center",children:[t("div",{class:"w-10 h-10 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-full flex items-center justify-center mr-3",children:t("span",{class:"text-white font-semibold text-sm",children:"U"})}),t("div",{children:[t("p",{class:"text-white font-medium",children:"ローディング中..."}),t("p",{class:"text-gray-400 text-sm",children:"user@example.com"})]})]})}),t("td",{class:"py-4 px-4",children:t("span",{class:"bg-cyber-blue/20 text-cyber-blue px-2 py-1 rounded-lg text-xs font-medium",children:"フリー"})}),t("td",{class:"py-4 px-4",children:t("div",{class:"text-white text-sm",children:[t("div",{children:"診断: -/-"}),t("div",{class:"text-gray-400",children:"A/B: -/-, コピー: -/-"})]})}),t("td",{class:"py-4 px-4 text-gray-400 text-sm",children:"-"}),t("td",{class:"py-4 px-4",children:t("div",{class:"flex space-x-2",children:[t("button",{class:"text-cyber-blue hover:text-cyber-purple transition-colors text-sm",children:t("i",{class:"fas fa-edit"})}),t("button",{class:"text-cyber-pink hover:text-red-400 transition-colors text-sm",children:t("i",{class:"fas fa-ban"})})]})})]})})]})}),t("div",{class:"flex items-center justify-between mt-6",children:[t("p",{class:"text-gray-400 text-sm",children:"1-10 of 100 ユーザー"}),t("div",{class:"flex space-x-2",children:[t("button",{class:"bg-navy-700 text-gray-400 px-3 py-1 rounded text-sm hover:bg-navy-600 transition-colors",children:"前へ"}),t("button",{class:"bg-cyber-blue text-white px-3 py-1 rounded text-sm",children:"1"}),t("button",{class:"bg-navy-700 text-gray-400 px-3 py-1 rounded text-sm hover:bg-navy-600 transition-colors",children:"2"}),t("button",{class:"bg-navy-700 text-gray-400 px-3 py-1 rounded text-sm hover:bg-navy-600 transition-colors",children:"次へ"})]})]})]})}),t("div",{class:"space-y-6",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("h3",{class:"text-lg font-semibold text-white mb-4",children:[t("i",{class:"fas fa-chart-pie mr-2 text-cyber-green"}),"プラン別統計"]}),t("div",{class:"space-y-4",children:[t("div",{class:"flex items-center justify-between",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-3 h-3 bg-gray-400 rounded-full mr-2"}),t("span",{class:"text-gray-300 text-sm",children:"フリー"})]}),t("div",{class:"text-right",children:[t("span",{class:"text-white font-medium",id:"freePlanCount",children:"-"}),t("span",{class:"text-gray-400 text-xs ml-1",children:["(",t("span",{id:"freePlanPercent",children:"-"}),"%)"]})]})]}),t("div",{class:"flex items-center justify-between",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-3 h-3 bg-cyber-blue rounded-full mr-2"}),t("span",{class:"text-gray-300 text-sm",children:"ベーシック"})]}),t("div",{class:"text-right",children:[t("span",{class:"text-white font-medium",id:"basicPlanCount",children:"-"}),t("span",{class:"text-gray-400 text-xs ml-1",children:["(",t("span",{id:"basicPlanPercent",children:"-"}),"%)"]})]})]}),t("div",{class:"flex items-center justify-between",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-3 h-3 bg-cyber-pink rounded-full mr-2"}),t("span",{class:"text-gray-300 text-sm",children:"プレミアム"})]}),t("div",{class:"text-right",children:[t("span",{class:"text-white font-medium",id:"premiumPlanCount",children:"-"}),t("span",{class:"text-gray-400 text-xs ml-1",children:["(",t("span",{id:"premiumPlanPercent",children:"-"}),"%)"]})]})]})]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("h3",{class:"text-lg font-semibold text-white mb-4",children:[t("i",{class:"fas fa-clock mr-2 text-cyber-orange"}),"最近のアクティビティ"]}),t("div",{class:"space-y-3",id:"recentActivity",children:[t("div",{class:"flex items-center text-sm",children:[t("div",{class:"w-2 h-2 bg-cyber-green rounded-full mr-3"}),t("div",{class:"flex-1",children:[t("span",{class:"text-gray-300",children:"新規ユーザー登録"}),t("span",{class:"text-gray-500 ml-2",children:"5分前"})]})]}),t("div",{class:"flex items-center text-sm",children:[t("div",{class:"w-2 h-2 bg-cyber-blue rounded-full mr-3"}),t("div",{class:"flex-1",children:[t("span",{class:"text-gray-300",children:"プラン変更 (Basic→Premium)"}),t("span",{class:"text-gray-500 ml-2",children:"12分前"})]})]}),t("div",{class:"flex items-center text-sm",children:[t("div",{class:"w-2 h-2 bg-cyber-pink rounded-full mr-3"}),t("div",{class:"flex-1",children:[t("span",{class:"text-gray-300",children:"AI診断実行"}),t("span",{class:"text-gray-500 ml-2",children:"18分前"})]})]})]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("h3",{class:"text-lg font-semibold text-white mb-4",children:[t("i",{class:"fas fa-cogs mr-2 text-gray-400"}),"システム設定"]}),t("div",{class:"space-y-3",children:[t("button",{class:"w-full text-left bg-navy-700/50 hover:bg-navy-700 transition-colors p-3 rounded-lg",children:t("div",{class:"flex items-center justify-between",children:[t("span",{class:"text-gray-300 text-sm",children:[t("i",{class:"fas fa-refresh mr-2"}),"使用回数リセット"]}),t("i",{class:"fas fa-chevron-right text-gray-500"})]})}),t("button",{class:"w-full text-left bg-navy-700/50 hover:bg-navy-700 transition-colors p-3 rounded-lg",children:t("div",{class:"flex items-center justify-between",children:[t("span",{class:"text-gray-300 text-sm",children:[t("i",{class:"fas fa-download mr-2"}),"データエクスポート"]}),t("i",{class:"fas fa-chevron-right text-gray-500"})]})}),t("button",{class:"w-full text-left bg-navy-700/50 hover:bg-navy-700 transition-colors p-3 rounded-lg",children:t("div",{class:"flex items-center justify-between",children:[t("span",{class:"text-gray-300 text-sm",children:[t("i",{class:"fas fa-bell mr-2"}),"通知設定"]}),t("i",{class:"fas fa-chevron-right text-gray-500"})]})})]})]})]})]})]}),t("div",{id:"editUserModal",class:"fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50",children:t("div",{class:"flex items-center justify-center min-h-screen p-4",children:t("div",{class:"bg-navy-800 rounded-2xl border border-gray-700 p-6 w-full max-w-md",children:[t("div",{class:"flex items-center justify-between mb-4",children:[t("h3",{class:"text-lg font-semibold text-white",children:"ユーザー編集"}),t("button",{id:"closeEditModal",class:"text-gray-400 hover:text-white",children:t("i",{class:"fas fa-times"})})]}),t("form",{id:"editUserForm",class:"space-y-4",children:[t("div",{children:[t("label",{class:"block text-gray-300 text-sm mb-2",children:"ユーザー名"}),t("input",{type:"text",id:"editUsername",class:"w-full bg-navy-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-cyber-blue focus:outline-none"})]}),t("div",{children:[t("label",{class:"block text-gray-300 text-sm mb-2",children:"メールアドレス"}),t("input",{type:"email",id:"editEmail",class:"w-full bg-navy-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-cyber-blue focus:outline-none"})]}),t("div",{children:[t("label",{class:"block text-gray-300 text-sm mb-2",children:"プラン"}),t("select",{id:"editPlan",class:"w-full bg-navy-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-cyber-blue focus:outline-none",children:[t("option",{value:"free",children:"フリー"}),t("option",{value:"basic",children:"ベーシック"}),t("option",{value:"premium",children:"プレミアム"})]})]}),t("div",{class:"flex space-x-3 pt-4",children:[t("button",{type:"submit",class:"flex-1 bg-cyber-blue text-white py-2 rounded-lg hover:bg-cyber-purple transition-colors",children:"保存"}),t("button",{type:"button",id:"cancelEdit",class:"flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-500 transition-colors",children:"キャンセル"})]})]})]})})})]}),ga=()=>t("div",{class:"min-h-screen bg-gradient-to-br from-navy-900 via-navy-800 to-navy-900",children:[t("header",{class:"bg-navy-800/50 backdrop-blur-lg border-b border-cyber-blue/20",children:t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t("div",{class:"flex justify-between items-center py-6",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-12 h-12 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-xl flex items-center justify-center mr-4",children:t("i",{class:"fas fa-user text-white text-xl"})}),t("div",{children:[t("h1",{class:"text-2xl font-orbitron font-bold text-white",children:"マイダッシュボード"}),t("p",{class:"text-cyber-blue text-sm",children:"バナスコAI 使用状況"})]})]}),t("div",{class:"flex items-center space-x-4",children:[t("div",{class:"text-right",children:[t("p",{class:"text-white font-medium user-name",children:"ユーザー名"}),t("p",{class:"text-gray-400 text-sm user-plan",children:"プラン"})]}),t("button",{class:"logout-btn bg-red-500/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-500/30 transition-colors",children:[t("i",{class:"fas fa-sign-out-alt mr-2"}),"ログアウト"]})]})]})})}),t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/20 p-6 mb-8",children:t("div",{class:"flex items-center justify-between",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-20 h-20 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-2xl flex items-center justify-center mr-6",children:t("i",{class:"fas fa-user-circle text-white text-3xl"})}),t("div",{children:[t("h2",{class:"text-2xl font-semibold text-white user-name",children:"ユーザー名"}),t("p",{class:"text-gray-400 user-email",children:"user@example.com"}),t("div",{class:"flex items-center mt-2",children:[t("span",{class:"bg-cyber-blue/20 text-cyber-blue px-3 py-1 rounded-lg text-sm font-medium user-plan",children:"フリープラン"}),t("span",{class:"ml-3 text-gray-400 text-sm",children:[t("i",{class:"fas fa-calendar mr-1"}),t("span",{id:"daysUntilReset",children:"-"}),"日でリセット"]})]})]})]}),t("div",{class:"text-right",children:t("button",{id:"upgradePlanBtn",class:"bg-gradient-to-r from-cyber-pink to-cyber-orange text-white px-6 py-3 rounded-xl font-semibold hover:from-cyber-orange hover:to-yellow-500 transition-all duration-300 transform hover:scale-105",children:[t("i",{class:"fas fa-crown mr-2"}),"プランアップグレード"]})})]})}),t("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/20 p-6",children:[t("div",{class:"flex items-center justify-between mb-4",children:t("div",{class:"flex items-center",children:[t("div",{class:"w-10 h-10 bg-cyber-blue/20 rounded-xl flex items-center justify-center mr-3",children:t("i",{class:"fas fa-chart-line text-cyber-blue"})}),t("h3",{class:"text-lg font-semibold text-white",children:"AI広告診断"})]})}),t("div",{class:"mb-4",children:[t("div",{class:"flex items-center justify-between mb-2",children:[t("span",{class:"text-gray-400 text-sm",children:"今月の使用量"}),t("span",{class:"text-white font-medium usage-single-analysis",children:"-/-"})]}),t("div",{class:"w-full bg-gray-700 rounded-full h-2",children:t("div",{id:"singleAnalysisProgress",class:"bg-cyber-blue h-2 rounded-full transition-all duration-300",style:"width: 0%"})}),t("div",{class:"flex items-center justify-between mt-2",children:[t("span",{class:"text-xs text-gray-500",children:"使用率"}),t("span",{id:"singleAnalysisPercentage",class:"text-xs text-cyber-blue",children:"0%"})]})]}),t("a",{href:"/analysis",class:"block w-full bg-cyber-blue/20 text-cyber-blue text-center py-2 rounded-lg hover:bg-cyber-blue/30 transition-colors text-sm font-medium",children:[t("i",{class:"fas fa-play mr-2"}),"診断を開始"]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-green/20 p-6",children:[t("div",{class:"flex items-center justify-between mb-4",children:t("div",{class:"flex items-center",children:[t("div",{class:"w-10 h-10 bg-cyber-green/20 rounded-xl flex items-center justify-center mr-3",children:t("i",{class:"fas fa-balance-scale text-cyber-green"})}),t("h3",{class:"text-lg font-semibold text-white",children:"A/B比較分析"})]})}),t("div",{class:"mb-4",children:[t("div",{class:"flex items-center justify-between mb-2",children:[t("span",{class:"text-gray-400 text-sm",children:"今月の使用量"}),t("span",{class:"text-white font-medium usage-ab-comparison",children:"-/-"})]}),t("div",{class:"w-full bg-gray-700 rounded-full h-2",children:t("div",{id:"abComparisonProgress",class:"bg-cyber-green h-2 rounded-full transition-all duration-300",style:"width: 0%"})}),t("div",{class:"flex items-center justify-between mt-2",children:[t("span",{class:"text-xs text-gray-500",children:"使用率"}),t("span",{id:"abComparisonPercentage",class:"text-xs text-cyber-green",children:"0%"})]})]}),t("a",{href:"/analysis",class:"block w-full bg-cyber-green/20 text-cyber-green text-center py-2 rounded-lg hover:bg-cyber-green/30 transition-colors text-sm font-medium",children:[t("i",{class:"fas fa-play mr-2"}),"比較を開始"]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-pink/20 p-6",children:[t("div",{class:"flex items-center justify-between mb-4",children:t("div",{class:"flex items-center",children:[t("div",{class:"w-10 h-10 bg-cyber-pink/20 rounded-xl flex items-center justify-center mr-3",children:t("i",{class:"fas fa-magic text-cyber-pink"})}),t("h3",{class:"text-lg font-semibold text-white",children:"AIコピー生成"})]})}),t("div",{class:"mb-4",children:[t("div",{class:"flex items-center justify-between mb-2",children:[t("span",{class:"text-gray-400 text-sm",children:"今月の使用量"}),t("span",{class:"text-white font-medium usage-copy-generation",children:"-/-"})]}),t("div",{class:"w-full bg-gray-700 rounded-full h-2",children:t("div",{id:"copyGenerationProgress",class:"bg-cyber-pink h-2 rounded-full transition-all duration-300",style:"width: 0%"})}),t("div",{class:"flex items-center justify-between mt-2",children:[t("span",{class:"text-xs text-gray-500",children:"使用率"}),t("span",{id:"copyGenerationPercentage",class:"text-xs text-cyber-pink",children:"0%"})]})]}),t("a",{href:"/copy-generation",class:"block w-full bg-cyber-pink/20 text-cyber-pink text-center py-2 rounded-lg hover:bg-cyber-pink/30 transition-colors text-sm font-medium",children:[t("i",{class:"fas fa-play mr-2"}),"生成を開始"]})]})]}),t("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("h3",{class:"text-xl font-semibold text-white mb-6",children:[t("i",{class:"fas fa-clock mr-2 text-cyber-orange"}),"最近のアクティビティ"]}),t("div",{class:"space-y-4",id:"recentActivity",children:[t("div",{class:"flex items-center p-3 bg-navy-700/30 rounded-lg",children:[t("div",{class:"w-8 h-8 bg-cyber-blue/20 rounded-lg flex items-center justify-center mr-3",children:t("i",{class:"fas fa-chart-line text-cyber-blue text-sm"})}),t("div",{class:"flex-1",children:[t("p",{class:"text-white text-sm",children:"AI広告診断を実行"}),t("p",{class:"text-gray-400 text-xs",children:"2分前"})]})]}),t("div",{class:"text-center py-8 text-gray-500",children:[t("i",{class:"fas fa-spinner fa-spin text-2xl mb-2"}),t("p",{children:"アクティビティを読み込み中..."})]})]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-6",children:[t("h3",{class:"text-xl font-semibold text-white mb-6",children:[t("i",{class:"fas fa-crown mr-2 text-cyber-pink"}),"プラン変更"]}),t("div",{class:"space-y-4",children:[t("div",{class:"p-4 bg-gray-700/30 rounded-lg border border-gray-600",children:[t("div",{class:"flex items-center justify-between mb-2",children:[t("h4",{class:"text-lg font-semibold text-white",children:"フリープラン"}),t("span",{class:"text-gray-400 font-bold",children:"¥0"})]}),t("ul",{class:"text-gray-300 text-sm space-y-1 mb-3",children:[t("li",{children:"• AI広告診断 月10回まで"}),t("li",{children:"• A/B比較分析 月5回まで"}),t("li",{children:"• AIコピー生成 月3回まで"})]}),t("button",{class:"w-full bg-gray-600 text-gray-400 py-2 rounded-lg cursor-not-allowed",disabled:!0,children:"現在のプラン"})]}),t("div",{class:"p-4 bg-cyber-blue/10 rounded-lg border border-cyber-blue/30",children:[t("div",{class:"flex items-center justify-between mb-2",children:[t("h4",{class:"text-lg font-semibold text-white",children:"ベーシックプラン"}),t("span",{class:"text-cyber-blue font-bold",children:["¥2,980",t("span",{class:"text-sm",children:"/月"})]})]}),t("ul",{class:"text-gray-300 text-sm space-y-1 mb-3",children:[t("li",{children:"• AI広告診断 月100回まで"}),t("li",{children:"• A/B比較分析 月50回まで"}),t("li",{children:"• AIコピー生成 月30回まで"}),t("li",{children:"• 詳細レポート・統計機能"})]}),t("button",{class:"upgrade-plan-btn w-full bg-cyber-blue text-white py-2 rounded-lg hover:bg-cyber-purple transition-colors","data-plan":"basic",children:"ベーシックにアップグレード"})]}),t("div",{class:"p-4 bg-cyber-pink/10 rounded-lg border border-cyber-pink/30",children:[t("div",{class:"flex items-center justify-between mb-2",children:[t("h4",{class:"text-lg font-semibold text-white",children:"プレミアムプラン"}),t("span",{class:"text-cyber-pink font-bold",children:["¥9,800",t("span",{class:"text-sm",children:"/月"})]})]}),t("ul",{class:"text-gray-300 text-sm space-y-1 mb-3",children:[t("li",{children:"• 全機能 無制限利用"}),t("li",{children:"• 高度な分析・予測機能"}),t("li",{children:"• カスタムレポート作成"}),t("li",{children:"• API アクセス"})]}),t("button",{class:"upgrade-plan-btn w-full bg-cyber-pink text-white py-2 rounded-lg hover:bg-pink-500 transition-colors","data-plan":"premium",children:"プレミアムにアップグレード"})]})]})]})]})]}),t("div",{id:"planChangeModal",class:"fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50",children:t("div",{class:"flex items-center justify-center min-h-screen p-4",children:t("div",{class:"bg-navy-800 rounded-2xl border border-gray-700 p-6 w-full max-w-md",children:[t("div",{class:"flex items-center justify-between mb-4",children:[t("h3",{class:"text-lg font-semibold text-white",children:"プラン変更確認"}),t("button",{id:"closePlanModal",class:"text-gray-400 hover:text-white",children:t("i",{class:"fas fa-times"})})]}),t("div",{class:"mb-6",children:[t("p",{class:"text-gray-300 mb-2",children:"以下のプランに変更しますか？"}),t("div",{class:"bg-navy-700 rounded-lg p-4",children:t("div",{class:"flex items-center justify-between",children:[t("span",{id:"newPlanName",class:"text-white font-medium",children:"プレミアムプラン"}),t("span",{id:"newPlanPrice",class:"text-cyber-pink font-bold",children:"¥9,800/月"})]})}),t("p",{class:"text-gray-400 text-sm mt-2",children:"※ プラン変更は即座に適用され、使用制限がリセットされます。"})]}),t("div",{class:"flex space-x-3",children:[t("button",{id:"confirmPlanChange",class:"flex-1 bg-cyber-blue text-white py-2 rounded-lg hover:bg-cyber-purple transition-colors",children:"変更する"}),t("button",{id:"cancelPlanChange",class:"flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-500 transition-colors",children:"キャンセル"})]})]})})})]}),ya=()=>t("div",{class:"min-h-screen bg-gradient-to-br from-navy-900 via-navy-800 to-navy-900",children:[t("header",{class:"bg-navy-800/50 backdrop-blur-lg border-b border-cyber-blue/20",children:t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t("div",{class:"flex justify-between items-center py-6",children:[t("div",{class:"flex items-center",children:[t("div",{class:"w-12 h-12 bg-gradient-to-r from-cyber-pink to-cyber-orange rounded-xl flex items-center justify-center mr-4",children:t("i",{class:"fas fa-crown text-white text-xl"})}),t("div",{children:[t("h1",{class:"text-2xl font-orbitron font-bold text-white",children:"プラン管理"}),t("p",{class:"text-cyber-pink text-sm",children:"最適なプランを選択"})]})]}),t("div",{class:"flex items-center space-x-4",children:t("a",{href:"/dashboard",class:"text-gray-400 hover:text-white transition-colors",children:[t("i",{class:"fas fa-arrow-left mr-2"}),"ダッシュボードに戻る"]})})]})})}),t("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[t("div",{class:"text-center mb-12",children:[t("h2",{class:"text-3xl font-bold text-white mb-4",children:"現在のプラン"}),t("div",{class:"inline-block bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/20 px-8 py-6",children:t("div",{class:"flex items-center justify-center space-x-4",children:[t("div",{class:"w-16 h-16 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-2xl flex items-center justify-center",children:t("i",{class:"fas fa-user text-white text-2xl"})}),t("div",{class:"text-left",children:[t("h3",{class:"text-xl font-semibold text-white user-plan",children:"フリープラン"}),t("p",{class:"text-gray-400 text-sm user-email",children:"user@example.com"})]})]})})]}),t("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12",children:[t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-8 text-center",children:[t("div",{class:"mb-6",children:[t("div",{class:"w-20 h-20 bg-gray-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:t("i",{class:"fas fa-user text-white text-2xl"})}),t("h3",{class:"text-2xl font-bold text-white mb-2",children:"フリープラン"}),t("div",{class:"text-4xl font-bold text-gray-400 mb-2",children:["¥0",t("span",{class:"text-lg font-normal",children:"/月"})]}),t("p",{class:"text-gray-400 text-sm",children:"個人利用向け"})]}),t("div",{class:"space-y-4 mb-8",children:[t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"AI広告診断"}),t("span",{class:"text-white font-medium",children:"月10回"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"A/B比較分析"}),t("span",{class:"text-white font-medium",children:"月5回"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"AIコピー生成"}),t("span",{class:"text-white font-medium",children:"月3回"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"基本レポート"}),t("span",{class:"text-cyber-green",children:t("i",{class:"fas fa-check"})})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"メールサポート"}),t("span",{class:"text-red-400",children:t("i",{class:"fas fa-times"})})]})]}),t("button",{class:"w-full bg-gray-600 text-gray-400 py-3 rounded-xl font-semibold cursor-not-allowed",disabled:!0,children:"現在のプラン"})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-blue/30 p-8 text-center relative",children:[t("div",{class:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:t("span",{class:"bg-cyber-blue text-white px-4 py-1 rounded-full text-sm font-medium",children:"おすすめ"})}),t("div",{class:"mb-6",children:[t("div",{class:"w-20 h-20 bg-gradient-to-r from-cyber-blue to-cyber-purple rounded-2xl flex items-center justify-center mx-auto mb-4",children:t("i",{class:"fas fa-rocket text-white text-2xl"})}),t("h3",{class:"text-2xl font-bold text-white mb-2",children:"ベーシックプラン"}),t("div",{class:"text-4xl font-bold text-cyber-blue mb-2",children:["¥2,980",t("span",{class:"text-lg font-normal",children:"/月"})]}),t("p",{class:"text-gray-400 text-sm",children:"小〜中規模事業者向け"})]}),t("div",{class:"space-y-4 mb-8",children:[t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"AI広告診断"}),t("span",{class:"text-white font-medium",children:"月100回"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"A/B比較分析"}),t("span",{class:"text-white font-medium",children:"月50回"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"AIコピー生成"}),t("span",{class:"text-white font-medium",children:"月30回"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"詳細レポート"}),t("span",{class:"text-cyber-green",children:t("i",{class:"fas fa-check"})})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"メールサポート"}),t("span",{class:"text-cyber-green",children:t("i",{class:"fas fa-check"})})]})]}),t("button",{class:"plan-select-btn w-full bg-gradient-to-r from-cyber-blue to-cyber-purple text-white py-3 rounded-xl font-semibold hover:from-cyber-purple hover:to-cyber-pink transition-all duration-300 transform hover:scale-105","data-plan":"basic",children:"ベーシックプランを選択"})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-cyber-pink/30 p-8 text-center relative",children:[t("div",{class:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:t("span",{class:"bg-gradient-to-r from-cyber-pink to-cyber-orange text-white px-4 py-1 rounded-full text-sm font-medium",children:"プロ向け"})}),t("div",{class:"mb-6",children:[t("div",{class:"w-20 h-20 bg-gradient-to-r from-cyber-pink to-cyber-orange rounded-2xl flex items-center justify-center mx-auto mb-4",children:t("i",{class:"fas fa-crown text-white text-2xl"})}),t("h3",{class:"text-2xl font-bold text-white mb-2",children:"プレミアムプラン"}),t("div",{class:"text-4xl font-bold text-cyber-pink mb-2",children:["¥9,800",t("span",{class:"text-lg font-normal",children:"/月"})]}),t("p",{class:"text-gray-400 text-sm",children:"大規模事業者・代理店向け"})]}),t("div",{class:"space-y-4 mb-8",children:[t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"AI広告診断"}),t("span",{class:"text-white font-medium",children:"無制限"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"A/B比較分析"}),t("span",{class:"text-white font-medium",children:"無制限"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"AIコピー生成"}),t("span",{class:"text-white font-medium",children:"無制限"})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"カスタムレポート"}),t("span",{class:"text-cyber-green",children:t("i",{class:"fas fa-check"})})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"優先サポート"}),t("span",{class:"text-cyber-green",children:t("i",{class:"fas fa-check"})})]}),t("div",{class:"flex items-center justify-between text-sm",children:[t("span",{class:"text-gray-300",children:"API アクセス"}),t("span",{class:"text-cyber-green",children:t("i",{class:"fas fa-check"})})]})]}),t("button",{class:"plan-select-btn w-full bg-gradient-to-r from-cyber-pink to-cyber-orange text-white py-3 rounded-xl font-semibold hover:from-cyber-orange hover:to-yellow-500 transition-all duration-300 transform hover:scale-105","data-plan":"premium",children:"プレミアムプランを選択"})]})]}),t("div",{class:"bg-navy-800/50 backdrop-blur-lg rounded-2xl border border-gray-700/30 p-8",children:[t("h3",{class:"text-2xl font-bold text-white mb-6 text-center",children:[t("i",{class:"fas fa-question-circle mr-2 text-cyber-blue"}),"よくある質問"]}),t("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[t("div",{children:[t("h4",{class:"text-lg font-semibold text-white mb-3",children:"プラン変更について"}),t("div",{class:"space-y-4 text-gray-300 text-sm",children:[t("div",{children:[t("p",{class:"font-medium text-cyber-blue mb-1",children:"Q: いつでもプランを変更できますか？"}),t("p",{children:"A: はい、いつでもプランの変更が可能です。変更は即座に適用されます。"})]}),t("div",{children:[t("p",{class:"font-medium text-cyber-blue mb-1",children:"Q: ダウングレードはできますか？"}),t("p",{children:"A: はい、可能です。ただし、使用制限は次回リセット時（月初）に適用されます。"})]})]})]}),t("div",{children:[t("h4",{class:"text-lg font-semibold text-white mb-3",children:"料金・支払いについて"}),t("div",{class:"space-y-4 text-gray-300 text-sm",children:[t("div",{children:[t("p",{class:"font-medium text-cyber-green mb-1",children:"Q: 支払い方法は？"}),t("p",{children:"A: クレジットカード、銀行振込に対応しています。"})]}),t("div",{children:[t("p",{class:"font-medium text-cyber-green mb-1",children:"Q: 無料トライアルはありますか？"}),t("p",{children:"A: フリープランで機能をお試しいただけます。"})]})]})]})]})]})]}),t("div",{id:"planSelectModal",class:"fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50",children:t("div",{class:"flex items-center justify-center min-h-screen p-4",children:t("div",{class:"bg-navy-800 rounded-2xl border border-gray-700 p-6 w-full max-w-lg",children:[t("div",{class:"flex items-center justify-between mb-4",children:[t("h3",{class:"text-lg font-semibold text-white",children:"プラン変更確認"}),t("button",{id:"closePlanSelectModal",class:"text-gray-400 hover:text-white",children:t("i",{class:"fas fa-times"})})]}),t("div",{class:"mb-6",children:[t("div",{class:"bg-navy-700 rounded-lg p-6 mb-4",children:[t("div",{class:"flex items-center justify-between mb-4",children:[t("div",{children:[t("h4",{id:"selectedPlanName",class:"text-xl font-bold text-white",children:"プレミアムプラン"}),t("p",{class:"text-gray-400",children:"に変更します"})]}),t("div",{class:"text-right",children:[t("div",{id:"selectedPlanPrice",class:"text-2xl font-bold text-cyber-pink",children:"¥9,800"}),t("div",{class:"text-gray-400 text-sm",children:"/月"})]})]}),t("div",{class:"border-t border-gray-600 pt-4",children:[t("h5",{class:"text-white font-medium mb-2",children:"主な機能:"}),t("ul",{id:"selectedPlanFeatures",class:"text-gray-300 text-sm space-y-1",children:[t("li",{children:"• 全機能無制限利用"}),t("li",{children:"• カスタムレポート作成"}),t("li",{children:"• 優先サポート"})]})]})]}),t("div",{class:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4",children:t("div",{class:"flex items-start",children:[t("i",{class:"fas fa-exclamation-triangle text-yellow-500 mr-2 mt-1"}),t("div",{class:"text-yellow-200 text-sm",children:[t("p",{class:"font-medium mb-1",children:"ご注意:"}),t("p",{children:"プラン変更は即座に適用され、使用制限がリセットされます。課金は変更日から開始されます。"})]})]})})]}),t("div",{class:"flex space-x-3",children:[t("button",{id:"confirmPlanSelect",class:"flex-1 bg-cyber-blue text-white py-3 rounded-lg hover:bg-cyber-purple transition-colors font-semibold",children:"変更を確定する"}),t("button",{id:"cancelPlanSelect",class:"flex-1 bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-500 transition-colors",children:"キャンセル"})]})]})})}),t("script",{src:"/static/js/plan-management.js"})]}),P=new ws;P.use("/api/*",Kn({origin:"*",allowHeaders:["Content-Type","Authorization"],allowMethods:["GET","POST","PUT","DELETE","OPTIONS"]}));P.use("/static/*",Vn({root:"./public"}));const xa=Mi(new URL("https://www.googleapis.com/service_accounts/v1/jwk/securetoken@system.gserviceaccount.com"));P.post("/api/session",async e=>{console.log("🔥 Firebase session endpoint called");let r;try{const s=await e.req.json();r=s==null?void 0:s.idToken,console.log("📨 Received idToken:",r?r.substring(0,20)+"...":"none")}catch(s){return console.error("❌ JSON parsing error:",s),e.json({ok:!1,message:"Invalid JSON body"},400)}if(!r)return console.log("❌ No idToken provided"),e.json({ok:!1,message:"idToken required"},400);try{const s=e.env.FIREBASE_PROJECT_ID||"banasuko-auth";console.log("🔧 Using Firebase project:",s);const{payload:n}=await Ri(r,xa,{issuer:`https://securetoken.google.com/${s}`,audience:s});return console.log("✅ Token verified successfully for user:",n.user_id),e.header("Set-Cookie",`bn_session=uid:${n.user_id}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=2592000`),e.json({ok:!0,uid:n.user_id,email:n.email??null,message:"Session created successfully"})}catch(s){if(console.error("💥 Token verification error:",s),(r==null?void 0:r.startsWith("test-"))||(r==null?void 0:r.startsWith("demo-"))||(r==null?void 0:r.startsWith("fake-"))){console.log("⚠️ Using development fallback for AI testing");const i={user_id:"test-user-"+Math.random().toString(36).substring(7),email:"test-user@example.com"};return e.header("Set-Cookie",`bn_session=uid:${i.user_id}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=2592000`),e.json({ok:!0,uid:i.user_id,email:i.email,message:"Test session created successfully"})}return e.json({ok:!1,message:(s==null?void 0:s.message)||"Invalid token",error:s.toString()},401)}});P.options("/api/session",e=>e.body(null,204));P.options("/api/auth/user",e=>e.body(null,204));P.options("/api/user/profile",e=>e.body(null,204));P.options("/api/usage/dashboard",e=>e.body(null,204));P.options("/api/analysis/single",e=>e.body(null,204));P.options("/api/analysis/ab",e=>e.body(null,204));const ut=e=>{var n;const r=(n=e.req.header("Cookie"))==null?void 0:n.split(";").find(i=>i.trim().startsWith("bn_session="));if(!r)return null;const s=r.split("=")[1];return s!=null&&s.startsWith("uid:")?{uid:s.replace("uid:",""),authenticated:!0}:null};P.get("/api/auth/user",async e=>{try{const r=ut(e);return r?e.json({success:!0,user:{uid:r.uid,email:`user-${r.uid.substring(0,8)}@example.com`,plan:"free",authenticated:!0}}):e.json({success:!1,message:"Not authenticated"},401)}catch(r){return console.error("ユーザー認証確認エラー:",r),e.json({success:!1,message:"Authentication check failed"},500)}});P.post("/api/user/profile",async e=>{try{const r=ut(e);if(!r)return e.json({success:!1,message:"Not authenticated"},401);const s=await e.req.json();return console.log("ユーザープロファイル作成:",{uid:r.uid,...s}),e.json({success:!0,message:"Profile created successfully",user:{uid:r.uid,email:s.email,plan:"free",createdAt:new Date().toISOString()}})}catch(r){return console.error("プロファイル作成エラー:",r),e.json({success:!1,message:"Profile creation failed"},500)}});P.get("/api/usage/dashboard",async e=>{try{const r=ut(e);if(!r)return e.json({success:!1,message:"Not authenticated"},401);const s={user:{uid:r.uid,email:`user-${r.uid.substring(0,8)}@example.com`,plan:"free",planName:"フリープラン"},usage:{singleAnalysis:{used:0,limit:10},abComparison:{used:0,limit:5},copyGeneration:{used:0,limit:3}},daysUntilReset:30};return e.json({success:!0,data:s})}catch(r){return console.error("ダッシュボードデータ取得エラー:",r),e.json({success:!1,message:"Dashboard data fetch failed"},500)}});P.post("/api/auth/logout",async e=>{console.log("🚪 ログアウトエンドポイント呼び出し");try{return e.header("Set-Cookie","bn_session=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0"),console.log("✅ ログアウト成功 - セッションクッキー削除完了"),e.json({success:!0,message:"Logged out successfully"})}catch(r){return console.error("❌ ログアウトエラー:",r),e.json({success:!1,message:"Logout failed"},500)}});P.options("/api/auth/logout",e=>e.body(null,204));P.post("/api/analysis/single",async e=>{console.log("🔍 単一画像分析エンドポイント呼び出し");try{const r=ut(e);if(!r)return e.json({success:!1,message:"Not authenticated"},401);const s=await e.req.json(),{image:n,platform:i,adType:a}=s;if(!n||!i)return e.json({success:!1,message:"Image and platform are required"},400);const l=e.env.OPENAI_API_KEY;if(!l)return console.error("❌ OpenAI API Key not configured"),e.json({success:!1,message:"AI service not configured"},500);console.log("🎯 分析開始:",{platform:i,adType:a,user:r.uid});const c=await Zt(n,i,a,l);return console.log("✅ 分析完了:",c.score||c.grade),e.json({success:!0,result:c,message:"分析が完了しました"})}catch(r){return console.error("❌ 分析エラー:",r),e.json({success:!1,message:"分析中にエラーが発生しました。もう一度試してください。",error:r.message},500)}});P.post("/api/analysis/ab",async e=>{console.log("🔍 A/B比較分析エンドポイント呼び出し");try{const r=ut(e);if(!r)return e.json({success:!1,message:"Not authenticated"},401);const s=await e.req.json(),{imageA:n,imageB:i,platform:a,adType:l}=s;if(!n||!i||!a)return e.json({success:!1,message:"Both images and platform are required"},400);const c=e.env.OPENAI_API_KEY;if(!c)return e.json({success:!1,message:"AI service not configured"},500);console.log("🎯 A/B分析開始:",{platform:a,adType:l,user:r.uid});const[o,d]=await Promise.all([Zt(n,a,l,c),Zt(i,a,l,c)]);return console.log("✅ A/B分析完了"),e.json({success:!0,result:{patternA:o,patternB:d,comparison:va(o,d)},message:"A/B比較分析が完了しました"})}catch(r){return console.error("❌ A/B分析エラー:",r),e.json({success:!1,message:"分析中にエラーが発生しました。もう一度試してください。",error:r.message},500)}});async function Zt(e,r,s,n){const i={"instagram-post":"このInstagram投稿画像を100点満点で採点してください。視覚的魅力、エンゲージメント予測、投稿としての効果を評価し、改善提案も含めてください。","instagram-ad":`このInstagram${s}広告を A/B/C の3段階で評価してください。訴求力、視覚的インパクト、コンバージョン予測を基準に判定し、詳細な改善提案を含めてください。`,gdn:"このGDN（Google Display Network）バナー広告をA/B/Cの3段階で評価してください。クリック率予測、視認性、訴求効果を分析してください。",yahoo:"このYahoo広告バナーをA/B/Cの3段階で評価してください。Yahoo広告の特徴を踏まえ、効果的な改善案を提案してください。"},a=i[r]||i["instagram-post"],l=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4-vision-preview",messages:[{role:"user",content:[{type:"text",text:a},{type:"image_url",image_url:{url:e}}]}],max_tokens:500})});if(!l.ok)throw new Error(`OpenAI API error: ${l.status}`);const o=(await l.json()).choices[0].message.content;if(r==="instagram-post"){const d=o.match(/(\d+)点|(\d+)\/100|Score:\s*(\d+)/i);return{score:d?parseInt(d[1]||d[2]||d[3]):75,analysis:o,improvements:Or(o),platform:r}}else{const d=o.match(/[評価判定]?\s*[：:]\s*([ABC])/i)||o.match(/\b([ABC])\s*[評価段階]/i);return{grade:d?d[1]:"B",analysis:o,improvements:Or(o),platform:r}}}function Or(e){const r=[],s=e.split(`
`);for(const n of s)(n.includes("改善")||n.includes("提案")||n.includes("向上")||n.includes("最適化"))&&r.push(n.trim());return r.length>0?r:["より詳細な分析のため、画像の解像度を上げることをお勧めします。"]}function va(e,r){if(e.score&&r.score){const s=e.score>r.score?"A":"B",n=Math.abs(e.score-r.score);return{winner:s,difference:n,summary:`パターン${s}が${n}点高い評価です。`}}else{const s={A:3,B:2,C:1},n=s[e.grade]||2,i=s[r.grade]||2,a=n>i?"A":n<i?"B":"引き分け";return{winner:a,summary:a==="引き分け"?"両パターンとも同程度の評価です。":`パターン${a}がより高い評価です。`}}}P.get("/api/status",async e=>{const r=e.env.OPENAI_API_KEY,s=e.env.PING,n=Object.keys(e.env||{}).length;return e.json({success:!0,status:{openai_configured:!!r,key_prefix:r?r.slice(0,3)+"...":"undefined...",ping_seen:s==="ok",env_keys_count:n,environment:"pages",cloudflare_context:!0,timestamp:new Date().toISOString()}})});P.use(ua);P.get("/",e=>e.render(t(ha,{})));P.get("/login",e=>e.render(t(fa,{})));P.get("/analysis",e=>e.render(t(ma,{})));P.get("/copy-generation",e=>e.render(t(pa,{})));P.get("/admin",e=>e.render(t(ba,{})));P.get("/dashboard",e=>e.render(t(ga,{})));P.get("/plan",e=>e.render(t(ya,{})));P.notFound(e=>e.render(t("div",{class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-navy-900 via-navy-800 to-navy-900",children:t("div",{class:"text-center",children:[t("h1",{class:"text-6xl font-bold text-cyber-blue mb-4",children:"404"}),t("p",{class:"text-xl text-gray-300 mb-8",children:"ページが見つかりません"}),t("a",{href:"/",class:"btn btn-primary",children:[t("i",{class:"fas fa-home mr-2"}),"ホームに戻る"]})]})})));const Lr=new ws,wa=Object.assign({"/src/app.tsx":P});let Hs=!1;for(const[,e]of Object.entries(wa))e&&(Lr.all("*",r=>{let s;try{s=r.executionCtx}catch{}return e.fetch(r.req.raw,r.env,s)}),Lr.notFound(r=>{let s;try{s=r.executionCtx}catch{}return e.fetch(r.req.raw,r.env,s)}),Hs=!0);if(!Hs)throw new Error("Can't import modules from ['/src/app.tsx']");export{Lr as default};
